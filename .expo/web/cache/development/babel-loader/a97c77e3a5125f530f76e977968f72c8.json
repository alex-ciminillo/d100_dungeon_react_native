{"ast":null,"code":"import $ from 'jquery';\nimport { useEffect } from 'react';\nimport * as THREE from \"./../libs/three.min.js\";\nimport * as CANNON from \"./../libs/cannon.min.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function DiceReact() {\n  window.teal = {};\n  window.$t = window.teal;\n\n  teal.copyto = function (obj, res) {\n    if (obj == null || typeof obj !== 'object') return obj;\n\n    if (obj instanceof Array) {\n      for (var i = obj.length - 1; i >= 0; --i) {\n        res[i] = $t.copy(obj[i]);\n      }\n    } else {\n      for (var i in obj) {\n        if (obj.hasOwnProperty(i)) res[i] = $t.copy(obj[i]);\n      }\n    }\n\n    return res;\n  };\n\n  teal.copy = function (obj) {\n    if (!obj) return obj;\n    return teal.copyto(obj, new obj.constructor());\n  };\n\n  teal.element = function (name, props, place, content) {\n    var dom = document.createElement(name);\n    if (props) for (var i in props) {\n      dom.setAttribute(i, props[i]);\n    }\n    if (place) place.appendChild(dom);\n    if (content !== undefined) $t.inner(content, dom);\n    return dom;\n  };\n\n  teal.inner = function (obj, sel) {\n    sel.appendChild(obj.nodeName != undefined ? obj : document.createTextNode(obj));\n    return sel;\n  };\n\n  teal.id = function (id) {\n    return document.getElementById(id);\n  };\n\n  teal.set = function (sel, props) {\n    for (var i in props) {\n      sel.setAttribute(i, props[i]);\n    }\n\n    return sel;\n  };\n\n  teal.clas = function (sel, oldclass, newclass) {\n    var oc = oldclass ? oldclass.split(/\\s+/) : [],\n        nc = newclass ? newclass.split(/\\s+/) : [],\n        classes = (sel.getAttribute('class') || '').split(/\\s+/);\n    if (!classes[0]) classes = [];\n\n    for (var i in oc) {\n      var ind = classes.indexOf(oc[i]);\n      if (ind >= 0) classes.splice(ind, 1);\n    }\n\n    for (var i in nc) {\n      if (nc[i] && classes.indexOf(nc[i]) < 0) classes.push(nc[i]);\n    }\n\n    sel.setAttribute('class', classes.join(' '));\n  };\n\n  teal.empty = function (sel) {\n    if (sel.childNodes) while (sel.childNodes.length) {\n      sel.removeChild(sel.firstChild);\n    }\n  };\n\n  teal.remove = function (sel) {\n    if (sel) {\n      if (sel.parentNode) sel.parentNode.removeChild(sel);else for (var i = sel.length - 1; i >= 0; --i) {\n        sel[i].parentNode.removeChild(sel[i]);\n      }\n    }\n  };\n\n  teal.bind = function (sel, eventname, func, bubble) {\n    if (!sel) return;\n\n    if (eventname.constructor === Array) {\n      for (var i in eventname) {\n        sel.addEventListener(eventname[i], func, bubble ? bubble : false);\n      }\n    } else sel.addEventListener(eventname, func, bubble ? bubble : false);\n  };\n\n  teal.unbind = function (sel, eventname, func, bubble) {\n    if (eventname.constructor === Array) {\n      for (var i in eventname) {\n        sel.removeEventListener(eventname[i], func, bubble ? bubble : false);\n      }\n    } else sel.removeEventListener(eventname, func, bubble ? bubble : false);\n  };\n\n  teal.one = function (sel, eventname, func, bubble) {\n    var one_func = function one_func(e) {\n      func.call(this, e);\n      teal.unbind(sel, eventname, one_func, bubble);\n    };\n\n    teal.bind(sel, eventname, one_func, bubble);\n  };\n\n  teal.raise_event = function (sel, eventname, bubble, cancelable) {\n    var evt = document.createEvent('UIEvents');\n    evt.initEvent(eventname, bubble == undefined ? true : bubble, cancelable == undefined ? true : cancelable);\n    sel.dispatchEvent(evt);\n  };\n\n  teal.raise = function (sel, eventname, params, bubble, cancelable) {\n    var ev = document.createEvent(\"CustomEvent\");\n    ev.initCustomEvent(eventname, bubble, cancelable, params);\n    sel.dispatchEvent(ev);\n  };\n\n  if (!document.getElementsByClassName) {\n    teal.get_elements_by_class = function (classes, node) {\n      var node = node || document,\n          list = node.getElementsByTagName('*'),\n          cl = classes.split(/\\s+/),\n          result = [];\n\n      for (var i = list.length - 1; i >= 0; --i) {\n        for (var j = cl.length - 1; j >= 0; --j) {\n          var clas = list[i].getAttribute('class');\n\n          if (clas && clas.search('\\\\b' + cl[j] + '\\\\b') != -1) {\n            result.push(list[i]);\n            break;\n          }\n        }\n      }\n\n      return result;\n    };\n  } else {\n    teal.get_elements_by_class = function (classes, node) {\n      return (node || document).getElementsByClassName(classes);\n    };\n  }\n\n  teal.rpc = function (params, callback, noparse) {\n    var ajax = new XMLHttpRequest();\n    ajax.open(\"post\", 'f', true);\n\n    ajax.onreadystatechange = function () {\n      if (ajax.readyState == 4) callback.call(ajax, noparse ? ajax.responseText : JSON.parse(ajax.responseText));\n    };\n\n    ajax.send(JSON.stringify(params));\n  };\n\n  teal.uuid = function () {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0,\n          v = c == 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  };\n\n  teal.get_url_params = function () {\n    var params = window.location.search.substring(1).split(\"&\");\n    var res = {};\n\n    for (var i in params) {\n      var keyvalue = params[i].split(\"=\");\n      res[keyvalue[0]] = decodeURI(keyvalue[1]);\n    }\n\n    return res;\n  };\n\n  teal.get_mouse_coords = function (ev) {\n    var touches = ev.changedTouches;\n    if (touches) return {\n      x: touches[0].clientX,\n      y: touches[0].clientY\n    };\n    return {\n      x: ev.clientX,\n      y: ev.clientY\n    };\n  };\n\n  teal.deferred = function () {\n    var solved = false,\n        callbacks = [],\n        args = [];\n\n    function solve() {\n      while (callbacks.length) {\n        callbacks.shift().apply(this, args);\n      }\n    }\n\n    console.log('hello');\n    return {\n      promise: function promise() {\n        return {\n          then: function then(callback) {\n            var deferred = teal.deferred(),\n                promise = deferred.promise();\n            callbacks.push(function () {\n              var res = callback.apply(this, arguments);\n              if (res && 'done' in res) res.done(deferred.resolve);else deferred.resolve.apply(this, arguments);\n            });\n            return promise;\n          },\n          done: function done(callback) {\n            callbacks.push(callback);\n            if (solved) solve();\n            return this;\n          },\n          cancel: function cancel() {\n            callbacks = [];\n          }\n        };\n      },\n      resolve: function resolve() {\n        solved = true;\n        args = Array.prototype.slice.call(arguments, 0);\n        solve();\n      }\n    };\n  };\n\n  teal.when = function (promises) {\n    var deferred = teal.deferred();\n    var count = promises.length,\n        ind = 0;\n    if (count == 0) deferred.resolve();\n\n    for (var i = 0; i < count; ++i) {\n      console.log(promises);\n      console.log(i);\n      promises[i].done(function () {\n        if (++ind == count) deferred.resolve();\n      });\n    }\n\n    return deferred.promise();\n  }(function (dice) {\n    var random_storage = [];\n    this.use_true_random = true;\n    this.frame_rate = 1 / 60;\n\n    function prepare_rnd(callback) {\n      if (!random_storage.length && $t.dice.use_true_random) {\n        try {\n          $t.rpc({\n            method: \"random\",\n            n: 512\n          }, function (random_responce) {\n            if (!random_responce.error) random_storage = random_responce.result.random.data;else $t.dice.use_true_random = false;\n            callback();\n          });\n          return;\n        } catch (e) {\n          $t.dice.use_true_random = false;\n        }\n      }\n\n      callback();\n    }\n\n    function rnd() {\n      return random_storage.length ? random_storage.pop() : Math.random();\n    }\n\n    function create_shape(vertices, faces, radius) {\n      var cv = new Array(vertices.length),\n          cf = new Array(faces.length);\n\n      for (var i = 0; i < vertices.length; ++i) {\n        var v = vertices[i];\n        cv[i] = new CANNON.Vec3(v.x * radius, v.y * radius, v.z * radius);\n      }\n\n      for (var i = 0; i < faces.length; ++i) {\n        cf[i] = faces[i].slice(0, faces[i].length - 1);\n      }\n\n      return new CANNON.ConvexPolyhedron(cv, cf);\n    }\n\n    function make_geom(vertices, faces, radius, tab, af) {\n      var geom = new THREE.Geometry();\n\n      for (var i = 0; i < vertices.length; ++i) {\n        var vertex = vertices[i].multiplyScalar(radius);\n        vertex.index = geom.vertices.push(vertex) - 1;\n      }\n\n      for (var i = 0; i < faces.length; ++i) {\n        var ii = faces[i],\n            fl = ii.length - 1;\n        var aa = Math.PI * 2 / fl;\n\n        for (var j = 0; j < fl - 2; ++j) {\n          geom.faces.push(new THREE.Face3(ii[0], ii[j + 1], ii[j + 2], [geom.vertices[ii[0]], geom.vertices[ii[j + 1]], geom.vertices[ii[j + 2]]], 0, ii[fl] + 1));\n          geom.faceVertexUvs[0].push([new THREE.Vector2((Math.cos(af) + 1 + tab) / 2 / (1 + tab), (Math.sin(af) + 1 + tab) / 2 / (1 + tab)), new THREE.Vector2((Math.cos(aa * (j + 1) + af) + 1 + tab) / 2 / (1 + tab), (Math.sin(aa * (j + 1) + af) + 1 + tab) / 2 / (1 + tab)), new THREE.Vector2((Math.cos(aa * (j + 2) + af) + 1 + tab) / 2 / (1 + tab), (Math.sin(aa * (j + 2) + af) + 1 + tab) / 2 / (1 + tab))]);\n        }\n      }\n\n      geom.computeFaceNormals();\n      geom.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\n      return geom;\n    }\n\n    function chamfer_geom(vectors, faces, chamfer) {\n      var chamfer_vectors = [],\n          chamfer_faces = [],\n          corner_faces = new Array(vectors.length);\n\n      for (var i = 0; i < vectors.length; ++i) {\n        corner_faces[i] = [];\n      }\n\n      for (var i = 0; i < faces.length; ++i) {\n        var ii = faces[i],\n            fl = ii.length - 1;\n        var center_point = new THREE.Vector3();\n        var face = new Array(fl);\n\n        for (var j = 0; j < fl; ++j) {\n          var vv = vectors[ii[j]].clone();\n          center_point.add(vv);\n          corner_faces[ii[j]].push(face[j] = chamfer_vectors.push(vv) - 1);\n        }\n\n        center_point.divideScalar(fl);\n\n        for (var j = 0; j < fl; ++j) {\n          var vv = chamfer_vectors[face[j]];\n          vv.subVectors(vv, center_point).multiplyScalar(chamfer).addVectors(vv, center_point);\n        }\n\n        face.push(ii[fl]);\n        chamfer_faces.push(face);\n      }\n\n      for (var i = 0; i < faces.length - 1; ++i) {\n        for (var j = i + 1; j < faces.length; ++j) {\n          var pairs = [],\n              lastm = -1;\n\n          for (var m = 0; m < faces[i].length - 1; ++m) {\n            var n = faces[j].indexOf(faces[i][m]);\n\n            if (n >= 0 && n < faces[j].length - 1) {\n              if (lastm >= 0 && m != lastm + 1) pairs.unshift([i, m], [j, n]);else pairs.push([i, m], [j, n]);\n              lastm = m;\n            }\n          }\n\n          if (pairs.length != 4) continue;\n          chamfer_faces.push([chamfer_faces[pairs[0][0]][pairs[0][1]], chamfer_faces[pairs[1][0]][pairs[1][1]], chamfer_faces[pairs[3][0]][pairs[3][1]], chamfer_faces[pairs[2][0]][pairs[2][1]], -1]);\n        }\n      }\n\n      for (var i = 0; i < corner_faces.length; ++i) {\n        var cf = corner_faces[i],\n            face = [cf[0]],\n            count = cf.length - 1;\n\n        while (count) {\n          for (var m = faces.length; m < chamfer_faces.length; ++m) {\n            var index = chamfer_faces[m].indexOf(face[face.length - 1]);\n\n            if (index >= 0 && index < 4) {\n              if (--index == -1) index = 3;\n              var next_vertex = chamfer_faces[m][index];\n\n              if (cf.indexOf(next_vertex) >= 0) {\n                face.push(next_vertex);\n                break;\n              }\n            }\n          }\n\n          --count;\n        }\n\n        face.push(-1);\n        chamfer_faces.push(face);\n      }\n\n      return {\n        vectors: chamfer_vectors,\n        faces: chamfer_faces\n      };\n    }\n\n    function create_geom(vertices, faces, radius, tab, af, chamfer) {\n      var vectors = new Array(vertices.length);\n\n      for (var i = 0; i < vertices.length; ++i) {\n        vectors[i] = new THREE.Vector3().fromArray(vertices[i]).normalize();\n      }\n\n      var cg = chamfer_geom(vectors, faces, chamfer);\n      var geom = make_geom(cg.vectors, cg.faces, radius, tab, af);\n      geom.cannon_shape = create_shape(vectors, faces, radius);\n      return geom;\n    }\n\n    this.standart_d20_dice_face_labels = [' ', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20'];\n    this.standart_d100_dice_face_labels = [' ', '00', '10', '20', '30', '40', '50', '60', '70', '80', '90'];\n\n    function calc_texture_size(approx) {\n      return Math.pow(2, Math.floor(Math.log(approx) / Math.log(2)));\n    }\n\n    this.create_dice_materials = function (face_labels, size, margin) {\n      function create_text_texture(text, color, back_color) {\n        if (text == undefined) return null;\n        var canvas = document.createElement(\"canvas\");\n        var context = canvas.getContext(\"2d\");\n        var ts = calc_texture_size(size + size * 2 * margin) * 2;\n        canvas.width = canvas.height = ts;\n        context.font = ts / (1 + 2 * margin) + \"pt Arial\";\n        context.fillStyle = back_color;\n        context.fillRect(0, 0, canvas.width, canvas.height);\n        context.textAlign = \"center\";\n        context.textBaseline = \"middle\";\n        context.fillStyle = color;\n        context.fillText(text, canvas.width / 2, canvas.height / 2);\n\n        if (text == '6' || text == '9') {\n          context.fillText('  .', canvas.width / 2, canvas.height / 2);\n        }\n\n        var texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        return texture;\n      }\n\n      var materials = [];\n\n      for (var i = 0; i < face_labels.length; ++i) {\n        materials.push(new THREE.MeshPhongMaterial($t.copyto(this.material_options, {\n          map: create_text_texture(face_labels[i], this.label_color, this.dice_color)\n        })));\n      }\n\n      return materials;\n    };\n\n    var d4_labels = [[[], [0, 0, 0], [2, 4, 3], [1, 3, 4], [2, 1, 4], [1, 2, 3]], [[], [0, 0, 0], [2, 3, 4], [3, 1, 4], [2, 4, 1], [3, 2, 1]], [[], [0, 0, 0], [4, 3, 2], [3, 4, 1], [4, 2, 1], [3, 1, 2]], [[], [0, 0, 0], [4, 2, 3], [1, 4, 3], [4, 1, 2], [1, 3, 2]]];\n\n    this.create_d4_materials = function (size, margin, labels) {\n      function create_d4_text(text, color, back_color) {\n        var canvas = document.createElement(\"canvas\");\n        var context = canvas.getContext(\"2d\");\n        var ts = calc_texture_size(size + margin) * 2;\n        canvas.width = canvas.height = ts;\n        context.font = (ts - margin) / 1.5 + \"pt Arial\";\n        context.fillStyle = back_color;\n        context.fillRect(0, 0, canvas.width, canvas.height);\n        context.textAlign = \"center\";\n        context.textBaseline = \"middle\";\n        context.fillStyle = color;\n\n        for (var i in text) {\n          context.fillText(text[i], canvas.width / 2, canvas.height / 2 - ts * 0.3);\n          context.translate(canvas.width / 2, canvas.height / 2);\n          context.rotate(Math.PI * 2 / 3);\n          context.translate(-canvas.width / 2, -canvas.height / 2);\n        }\n\n        var texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        return texture;\n      }\n\n      var materials = [];\n\n      for (var i = 0; i < labels.length; ++i) {\n        materials.push(new THREE.MeshPhongMaterial($t.copyto(this.material_options, {\n          map: create_d4_text(labels[i], this.label_color, this.dice_color)\n        })));\n      }\n\n      return materials;\n    };\n\n    this.create_d4_geometry = function (radius) {\n      var vertices = [[1, 1, 1], [-1, -1, 1], [-1, 1, -1], [1, -1, -1]];\n      var faces = [[1, 0, 2, 1], [0, 1, 3, 2], [0, 3, 2, 3], [1, 2, 3, 4]];\n      return create_geom(vertices, faces, radius, -0.1, Math.PI * 7 / 6, 0.96);\n    };\n\n    this.create_d6_geometry = function (radius) {\n      var vertices = [[-1, -1, -1], [1, -1, -1], [1, 1, -1], [-1, 1, -1], [-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]];\n      var faces = [[0, 3, 2, 1, 1], [1, 2, 6, 5, 2], [0, 1, 5, 4, 3], [3, 7, 6, 2, 4], [0, 4, 7, 3, 5], [4, 5, 6, 7, 6]];\n      return create_geom(vertices, faces, radius, 0.1, Math.PI / 4, 0.96);\n    };\n\n    this.create_d8_geometry = function (radius) {\n      var vertices = [[1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0], [0, 0, 1], [0, 0, -1]];\n      var faces = [[0, 2, 4, 1], [0, 4, 3, 2], [0, 3, 5, 3], [0, 5, 2, 4], [1, 3, 4, 5], [1, 4, 2, 6], [1, 2, 5, 7], [1, 5, 3, 8]];\n      return create_geom(vertices, faces, radius, 0, -Math.PI / 4 / 2, 0.965);\n    };\n\n    this.create_d10_geometry = function (radius) {\n      var a = Math.PI * 2 / 10,\n          k = Math.cos(a),\n          h = 0.105,\n          v = -1;\n      var vertices = [];\n\n      for (var i = 0, b = 0; i < 10; ++i, b += a) {\n        vertices.push([Math.cos(b), Math.sin(b), h * (i % 2 ? 1 : -1)]);\n      }\n\n      vertices.push([0, 0, -1]);\n      vertices.push([0, 0, 1]);\n      var faces = [[5, 7, 11, 0], [4, 2, 10, 1], [1, 3, 11, 2], [0, 8, 10, 3], [7, 9, 11, 4], [8, 6, 10, 5], [9, 1, 11, 6], [2, 0, 10, 7], [3, 5, 11, 8], [6, 4, 10, 9], [1, 0, 2, v], [1, 2, 3, v], [3, 2, 4, v], [3, 4, 5, v], [5, 4, 6, v], [5, 6, 7, v], [7, 6, 8, v], [7, 8, 9, v], [9, 8, 0, v], [9, 0, 1, v]];\n      return create_geom(vertices, faces, radius, 0, Math.PI * 6 / 5, 0.945);\n    };\n\n    this.create_d12_geometry = function (radius) {\n      var p = (1 + Math.sqrt(5)) / 2,\n          q = 1 / p;\n      var vertices = [[0, q, p], [0, q, -p], [0, -q, p], [0, -q, -p], [p, 0, q], [p, 0, -q], [-p, 0, q], [-p, 0, -q], [q, p, 0], [q, -p, 0], [-q, p, 0], [-q, -p, 0], [1, 1, 1], [1, 1, -1], [1, -1, 1], [1, -1, -1], [-1, 1, 1], [-1, 1, -1], [-1, -1, 1], [-1, -1, -1]];\n      var faces = [[2, 14, 4, 12, 0, 1], [15, 9, 11, 19, 3, 2], [16, 10, 17, 7, 6, 3], [6, 7, 19, 11, 18, 4], [6, 18, 2, 0, 16, 5], [18, 11, 9, 14, 2, 6], [1, 17, 10, 8, 13, 7], [1, 13, 5, 15, 3, 8], [13, 8, 12, 4, 5, 9], [5, 4, 14, 9, 15, 10], [0, 12, 8, 10, 16, 11], [3, 19, 7, 17, 1, 12]];\n      return create_geom(vertices, faces, radius, 0.2, -Math.PI / 4 / 2, 0.968);\n    };\n\n    this.create_d20_geometry = function (radius) {\n      var t = (1 + Math.sqrt(5)) / 2;\n      var vertices = [[-1, t, 0], [1, t, 0], [-1, -t, 0], [1, -t, 0], [0, -1, t], [0, 1, t], [0, -1, -t], [0, 1, -t], [t, 0, -1], [t, 0, 1], [-t, 0, -1], [-t, 0, 1]];\n      var faces = [[0, 11, 5, 1], [0, 5, 1, 2], [0, 1, 7, 3], [0, 7, 10, 4], [0, 10, 11, 5], [1, 5, 9, 6], [5, 11, 4, 7], [11, 10, 2, 8], [10, 7, 6, 9], [7, 1, 8, 10], [3, 9, 4, 11], [3, 4, 2, 12], [3, 2, 6, 13], [3, 6, 8, 14], [3, 8, 9, 15], [4, 9, 5, 16], [2, 4, 11, 17], [6, 2, 10, 18], [8, 6, 7, 19], [9, 8, 1, 20]];\n      return create_geom(vertices, faces, radius, -0.2, -Math.PI / 4 / 2, 0.955);\n    };\n\n    this.material_options = {\n      specular: 0x172022,\n      color: 0xf0f0f0,\n      shininess: 40,\n      shading: THREE.FlatShading\n    };\n    this.label_color = '#aaaaaa';\n    this.dice_color = '#202020';\n    this.ambient_light_color = 0xf0f5fb;\n    this.spot_light_color = 0xefdfd5;\n    this.selector_back_colors = {\n      color: 0x404040,\n      shininess: 0,\n      emissive: 0x858787\n    };\n    this.desk_color = 0xdfdfdf;\n    this.use_shadows = true;\n    this.known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];\n    this.dice_face_range = {\n      'd4': [1, 4],\n      'd6': [1, 6],\n      'd8': [1, 8],\n      'd10': [0, 9],\n      'd12': [1, 12],\n      'd20': [1, 20],\n      'd100': [0, 9]\n    };\n    this.dice_mass = {\n      'd4': 300,\n      'd6': 300,\n      'd8': 340,\n      'd10': 350,\n      'd12': 350,\n      'd20': 400,\n      'd100': 350\n    };\n    this.dice_inertia = {\n      'd4': 5,\n      'd6': 13,\n      'd8': 10,\n      'd10': 9,\n      'd12': 8,\n      'd20': 6,\n      'd100': 9\n    };\n    this.scale = 50;\n\n    this.create_d4 = function () {\n      if (!this.d4_geometry) this.d4_geometry = this.create_d4_geometry(this.scale * 1.2);\n      if (!this.d4_material) this.d4_material = new THREE.MeshFaceMaterial(this.create_d4_materials(this.scale / 2, this.scale * 2, d4_labels[0]));\n      return new THREE.Mesh(this.d4_geometry, this.d4_material);\n    };\n\n    this.create_d6 = function () {\n      if (!this.d6_geometry) this.d6_geometry = this.create_d6_geometry(this.scale * 0.9);\n      if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n      return new THREE.Mesh(this.d6_geometry, this.dice_material);\n    };\n\n    this.create_d8 = function () {\n      if (!this.d8_geometry) this.d8_geometry = this.create_d8_geometry(this.scale);\n      if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.2));\n      return new THREE.Mesh(this.d8_geometry, this.dice_material);\n    };\n\n    this.create_d10 = function () {\n      if (!this.d10_geometry) this.d10_geometry = this.create_d10_geometry(this.scale * 0.9);\n      if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n      return new THREE.Mesh(this.d10_geometry, this.dice_material);\n    };\n\n    this.create_d12 = function () {\n      if (!this.d12_geometry) this.d12_geometry = this.create_d12_geometry(this.scale * 0.9);\n      if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n      return new THREE.Mesh(this.d12_geometry, this.dice_material);\n    };\n\n    this.create_d20 = function () {\n      if (!this.d20_geometry) this.d20_geometry = this.create_d20_geometry(this.scale);\n      if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n      return new THREE.Mesh(this.d20_geometry, this.dice_material);\n    };\n\n    this.create_d100 = function () {\n      if (!this.d10_geometry) this.d10_geometry = this.create_d10_geometry(this.scale * 0.9);\n      if (!this.d100_material) this.d100_material = new THREE.MeshFaceMaterial(this.create_dice_materials(this.standart_d100_dice_face_labels, this.scale / 2, 1.5));\n      return new THREE.Mesh(this.d10_geometry, this.d100_material);\n    };\n\n    this.parse_notation = function (notation) {\n      var no = notation.split('@');\n      var dr0 = /\\s*(\\d*)([a-z]+)(\\d+)(\\s*(\\+|\\-)\\s*(\\d+)){0,1}\\s*(\\+|$)/gi;\n      var dr1 = /(\\b)*(\\d+)(\\b)*/gi;\n      var ret = {\n        set: [],\n        constant: 0,\n        result: [],\n        error: false\n      },\n          res;\n\n      while (res = dr0.exec(no[0])) {\n        var command = res[2];\n\n        if (command != 'd') {\n          ret.error = true;\n          continue;\n        }\n\n        var count = parseInt(res[1]);\n        if (res[1] == '') count = 1;\n        var type = 'd' + res[3];\n\n        if (this.known_types.indexOf(type) == -1) {\n          ret.error = true;\n          continue;\n        }\n\n        while (count--) {\n          ret.set.push(type);\n        }\n\n        if (res[5] && res[6]) {\n          if (res[5] == '+') ret.constant += parseInt(res[6]);else ret.constant -= parseInt(res[6]);\n        }\n      }\n\n      while (res = dr1.exec(no[1])) {\n        ret.result.push(parseInt(res[2]));\n      }\n\n      return ret;\n    };\n\n    this.stringify_notation = function (nn) {\n      var dict = {},\n          notation = '';\n\n      for (var i in nn.set) {\n        if (!dict[nn.set[i]]) dict[nn.set[i]] = 1;else ++dict[nn.set[i]];\n      }\n\n      for (var i in dict) {\n        if (notation.length) notation += ' + ';\n        notation += (dict[i] > 1 ? dict[i] : '') + i;\n      }\n\n      if (nn.constant) {\n        if (nn.constant > 0) notation += ' + ' + nn.constant;else notation += ' - ' + Math.abs(nn.constant);\n      }\n\n      return notation;\n    };\n\n    var that = this;\n\n    this.dice_box = function (container, dimentions) {\n      this.use_adapvite_timestep = true;\n      this.animate_selector = true;\n      this.dices = [];\n      this.scene = new THREE.Scene();\n      this.world = new CANNON.World();\n      this.renderer = window.WebGLRenderingContext ? new THREE.WebGLRenderer({\n        antialias: true\n      }) : new THREE.CanvasRenderer({\n        antialias: true\n      });\n      container.appendChild(this.renderer.domElement);\n      this.renderer.shadowMap.enabled = true;\n      this.renderer.shadowMap.type = THREE.PCFShadowMap;\n      this.renderer.setClearColor(0xffffff, 1);\n      this.reinit(container, dimentions);\n      this.world.gravity.set(0, 0, -9.8 * 800);\n      this.world.broadphase = new CANNON.NaiveBroadphase();\n      this.world.solver.iterations = 16;\n      var ambientLight = new THREE.AmbientLight(that.ambient_light_color);\n      this.scene.add(ambientLight);\n      this.dice_body_material = new CANNON.Material();\n      var desk_body_material = new CANNON.Material();\n      var barrier_body_material = new CANNON.Material();\n      this.world.addContactMaterial(new CANNON.ContactMaterial(desk_body_material, this.dice_body_material, 0.01, 0.5));\n      this.world.addContactMaterial(new CANNON.ContactMaterial(barrier_body_material, this.dice_body_material, 0, 1.0));\n      this.world.addContactMaterial(new CANNON.ContactMaterial(this.dice_body_material, this.dice_body_material, 0, 0.5));\n      this.world.add(new CANNON.RigidBody(0, new CANNON.Plane(), desk_body_material));\n      var barrier;\n      barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n      barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), Math.PI / 2);\n      barrier.position.set(0, this.h * 0.93, 0);\n      this.world.add(barrier);\n      barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n      barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);\n      barrier.position.set(0, -this.h * 0.93, 0);\n      this.world.add(barrier);\n      barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n      barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(0, 1, 0), -Math.PI / 2);\n      barrier.position.set(this.w * 0.93, 0, 0);\n      this.world.add(barrier);\n      barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n      barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(0, 1, 0), Math.PI / 2);\n      barrier.position.set(-this.w * 0.93, 0, 0);\n      this.world.add(barrier);\n      this.last_time = 0;\n      this.running = false;\n      this.renderer.render(this.scene, this.camera);\n    };\n\n    this.dice_box.prototype.reinit = function (container, dimentions) {\n      this.cw = container.clientWidth / 2;\n      this.ch = container.clientHeight / 2;\n\n      if (dimentions) {\n        this.w = dimentions.w;\n        this.h = dimentions.h;\n      } else {\n        this.w = this.cw;\n        this.h = this.ch;\n      }\n\n      this.aspect = Math.min(this.cw / this.w, this.ch / this.h);\n      that.scale = Math.sqrt(this.w * this.w + this.h * this.h) / 13;\n      this.renderer.setSize(this.cw * 2, this.ch * 2);\n      this.wh = this.ch / this.aspect / Math.tan(10 * Math.PI / 180);\n      if (this.camera) this.scene.remove(this.camera);\n      this.camera = new THREE.PerspectiveCamera(20, this.cw / this.ch, 1, this.wh * 1.3);\n      this.camera.position.z = this.wh;\n      var mw = Math.max(this.w, this.h);\n      if (this.light) this.scene.remove(this.light);\n      this.light = new THREE.SpotLight(that.spot_light_color, 2.0);\n      this.light.position.set(-mw / 2, mw / 2, mw * 2);\n      this.light.target.position.set(0, 0, 0);\n      this.light.distance = mw * 5;\n      this.light.castShadow = true;\n      this.light.shadowCameraNear = mw / 10;\n      this.light.shadowCameraFar = mw * 5;\n      this.light.shadowCameraFov = 50;\n      this.light.shadowBias = 0.001;\n      this.light.shadowDarkness = 1.1;\n      this.light.shadowMapWidth = 1024;\n      this.light.shadowMapHeight = 1024;\n      this.scene.add(this.light);\n      if (this.desk) this.scene.remove(this.desk);\n      this.desk = new THREE.Mesh(new THREE.PlaneGeometry(this.w * 2, this.h * 2, 1, 1), new THREE.MeshPhongMaterial({\n        color: that.desk_color\n      }));\n      this.desk.receiveShadow = that.use_shadows;\n      this.scene.add(this.desk);\n      this.renderer.render(this.scene, this.camera);\n    };\n\n    function make_random_vector(vector) {\n      var random_angle = rnd() * Math.PI / 5 - Math.PI / 5 / 2;\n      var vec = {\n        x: vector.x * Math.cos(random_angle) - vector.y * Math.sin(random_angle),\n        y: vector.x * Math.sin(random_angle) + vector.y * Math.cos(random_angle)\n      };\n      if (vec.x == 0) vec.x = 0.01;\n      if (vec.y == 0) vec.y = 0.01;\n      return vec;\n    }\n\n    this.dice_box.prototype.generate_vectors = function (notation, vector, boost) {\n      var vectors = [];\n\n      for (var i in notation.set) {\n        var vec = make_random_vector(vector);\n        var pos = {\n          x: this.w * (vec.x > 0 ? -1 : 1) * 0.9,\n          y: this.h * (vec.y > 0 ? -1 : 1) * 0.9,\n          z: rnd() * 200 + 200\n        };\n        var projector = Math.abs(vec.x / vec.y);\n        if (projector > 1.0) pos.y /= projector;else pos.x *= projector;\n        var velvec = make_random_vector(vector);\n        var velocity = {\n          x: velvec.x * boost,\n          y: velvec.y * boost,\n          z: -10\n        };\n        var inertia = that.dice_inertia[notation.set[i]];\n        var angle = {\n          x: -(rnd() * vec.y * 5 + inertia * vec.y),\n          y: rnd() * vec.x * 5 + inertia * vec.x,\n          z: 0\n        };\n        var axis = {\n          x: rnd(),\n          y: rnd(),\n          z: rnd(),\n          a: rnd()\n        };\n        vectors.push({\n          set: notation.set[i],\n          pos: pos,\n          velocity: velocity,\n          angle: angle,\n          axis: axis\n        });\n      }\n\n      return vectors;\n    };\n\n    this.dice_box.prototype.create_dice = function (type, pos, velocity, angle, axis) {\n      var dice = that['create_' + type]();\n      dice.castShadow = true;\n      dice.dice_type = type;\n      dice.body = new CANNON.RigidBody(that.dice_mass[type], dice.geometry.cannon_shape, this.dice_body_material);\n      dice.body.position.set(pos.x, pos.y, pos.z);\n      dice.body.quaternion.setFromAxisAngle(new CANNON.Vec3(axis.x, axis.y, axis.z), axis.a * Math.PI * 2);\n      dice.body.angularVelocity.set(angle.x, angle.y, angle.z);\n      dice.body.velocity.set(velocity.x, velocity.y, velocity.z);\n      dice.body.linearDamping = 0.1;\n      dice.body.angularDamping = 0.1;\n      this.scene.add(dice);\n      this.dices.push(dice);\n      this.world.add(dice.body);\n    };\n\n    this.dice_box.prototype.check_if_throw_finished = function () {\n      var res = true;\n      var e = 6;\n\n      if (this.iteration < 10 / that.frame_rate) {\n        for (var i = 0; i < this.dices.length; ++i) {\n          var dice = this.dices[i];\n          if (dice.dice_stopped === true) continue;\n          var a = dice.body.angularVelocity,\n              v = dice.body.velocity;\n\n          if (Math.abs(a.x) < e && Math.abs(a.y) < e && Math.abs(a.z) < e && Math.abs(v.x) < e && Math.abs(v.y) < e && Math.abs(v.z) < e) {\n            if (dice.dice_stopped) {\n              if (this.iteration - dice.dice_stopped > 3) {\n                dice.dice_stopped = true;\n                continue;\n              }\n            } else dice.dice_stopped = this.iteration;\n\n            res = false;\n          } else {\n            dice.dice_stopped = undefined;\n            res = false;\n          }\n        }\n      }\n\n      return res;\n    };\n\n    function get_dice_value(dice) {\n      var vector = new THREE.Vector3(0, 0, dice.dice_type == 'd4' ? -1 : 1);\n      var closest_face,\n          closest_angle = Math.PI * 2;\n\n      for (var i = 0, l = dice.geometry.faces.length; i < l; ++i) {\n        var face = dice.geometry.faces[i];\n        if (face.materialIndex == 0) continue;\n        var angle = face.normal.clone().applyQuaternion(dice.body.quaternion).angleTo(vector);\n\n        if (angle < closest_angle) {\n          closest_angle = angle;\n          closest_face = face;\n        }\n      }\n\n      var matindex = closest_face.materialIndex - 1;\n      if (dice.dice_type == 'd100') matindex *= 10;\n      if (dice.dice_type == 'd10' && matindex == 0) matindex = 10;\n      return matindex;\n    }\n\n    function get_dice_values(dices) {\n      var values = [];\n\n      for (var i = 0, l = dices.length; i < l; ++i) {\n        values.push(get_dice_value(dices[i]));\n      }\n\n      return values;\n    }\n\n    this.dice_box.prototype.emulate_throw = function () {\n      while (!this.check_if_throw_finished()) {\n        ++this.iteration;\n        this.world.step(that.frame_rate);\n      }\n\n      return get_dice_values(this.dices);\n    };\n\n    this.dice_box.prototype.__animate = function (threadid) {\n      var time = new Date().getTime();\n      var time_diff = (time - this.last_time) / 1000;\n      if (time_diff > 3) time_diff = that.frame_rate;\n      ++this.iteration;\n\n      if (this.use_adapvite_timestep) {\n        while (time_diff > that.frame_rate * 1.1) {\n          this.world.step(that.frame_rate);\n          time_diff -= that.frame_rate;\n        }\n\n        this.world.step(time_diff);\n      } else {\n        this.world.step(that.frame_rate);\n      }\n\n      for (var i in this.scene.children) {\n        var interact = this.scene.children[i];\n\n        if (interact.body != undefined) {\n          interact.position.copy(interact.body.position);\n          interact.quaternion.copy(interact.body.quaternion);\n        }\n      }\n\n      this.renderer.render(this.scene, this.camera);\n      this.last_time = this.last_time ? time : new Date().getTime();\n\n      if (this.running == threadid && this.check_if_throw_finished()) {\n        this.running = false;\n        if (this.callback) this.callback.call(this, get_dice_values(this.dices));\n      }\n\n      if (this.running == threadid) {\n        (function (t, tid, uat) {\n          if (!uat && time_diff < that.frame_rate) {\n            setTimeout(function () {\n              requestAnimationFrame(function () {\n                t.__animate(tid);\n              });\n            }, (that.frame_rate - time_diff) * 1000);\n          } else requestAnimationFrame(function () {\n            t.__animate(tid);\n          });\n        })(this, threadid, this.use_adapvite_timestep);\n      }\n    };\n\n    this.dice_box.prototype.clear = function () {\n      this.running = false;\n      var dice;\n\n      while (dice = this.dices.pop()) {\n        this.scene.remove(dice);\n        if (dice.body) this.world.remove(dice.body);\n      }\n\n      if (this.pane) this.scene.remove(this.pane);\n      this.renderer.render(this.scene, this.camera);\n      var box = this;\n      setTimeout(function () {\n        box.renderer.render(box.scene, box.camera);\n      }, 100);\n    };\n\n    this.dice_box.prototype.prepare_dices_for_roll = function (vectors) {\n      this.clear();\n      this.iteration = 0;\n\n      for (var i in vectors) {\n        this.create_dice(vectors[i].set, vectors[i].pos, vectors[i].velocity, vectors[i].angle, vectors[i].axis);\n      }\n    };\n\n    function shift_dice_faces(dice, value, res) {\n      var r = that.dice_face_range[dice.dice_type];\n      if (dice.dice_type == 'd10' && value == 10) value = 0;\n      if (!(value >= r[0] && value <= r[1])) return;\n      var num = value - res;\n      var geom = dice.geometry.clone();\n\n      for (var i = 0, l = geom.faces.length; i < l; ++i) {\n        var matindex = geom.faces[i].materialIndex;\n        if (matindex == 0) continue;\n        matindex += num - 1;\n\n        while (matindex > r[1]) {\n          matindex -= r[1];\n        }\n\n        while (matindex < r[0]) {\n          matindex += r[1];\n        }\n\n        geom.faces[i].materialIndex = matindex + 1;\n      }\n\n      if (dice.dice_type == 'd4' && num != 0) {\n        if (num < 0) num += 4;\n        dice.material = new THREE.MeshFaceMaterial(that.create_d4_materials(that.scale / 2, that.scale * 2, d4_labels[num]));\n      }\n\n      dice.geometry = geom;\n    }\n\n    this.dice_box.prototype.roll = function (vectors, values, callback) {\n      this.prepare_dices_for_roll(vectors);\n\n      if (values != undefined && values.length) {\n        this.use_adapvite_timestep = false;\n        var res = this.emulate_throw();\n        this.prepare_dices_for_roll(vectors);\n\n        for (var i in res) {\n          shift_dice_faces(this.dices[i], values[i], res[i]);\n        }\n      }\n\n      this.callback = callback;\n      this.running = new Date().getTime();\n      this.last_time = 0;\n\n      this.__animate(this.running);\n    };\n\n    this.dice_box.prototype.__selector_animate = function (threadid) {\n      var time = new Date().getTime();\n      var time_diff = (time - this.last_time) / 1000;\n      if (time_diff > 3) time_diff = that.frame_rate;\n      var angle_change = 0.3 * time_diff * Math.PI * Math.min(24000 + threadid - time, 6000) / 6000;\n      if (angle_change < 0) this.running = false;\n\n      for (var i in this.dices) {\n        this.dices[i].rotation.y += angle_change;\n        this.dices[i].rotation.x += angle_change / 4;\n        this.dices[i].rotation.z += angle_change / 10;\n      }\n\n      this.last_time = time;\n      this.renderer.render(this.scene, this.camera);\n\n      if (this.running == threadid) {\n        (function (t, tid) {\n          requestAnimationFrame(function () {\n            t.__selector_animate(tid);\n          });\n        })(this, threadid);\n      }\n    };\n\n    this.dice_box.prototype.search_dice_by_mouse = function (ev) {\n      var m = $t.get_mouse_coords(ev);\n      var intersects = new THREE.Raycaster(this.camera.position, new THREE.Vector3((m.x - this.cw) / this.aspect, 1 - (m.y - this.ch) / this.aspect, this.w / 9).sub(this.camera.position).normalize()).intersectObjects(this.dices);\n      if (intersects.length) return intersects[0].object.userData;\n    };\n\n    this.dice_box.prototype.draw_selector = function () {\n      this.clear();\n      var step = this.w / 4.5;\n      this.pane = new THREE.Mesh(new THREE.PlaneGeometry(this.w * 6, this.h * 6, 1, 1), new THREE.MeshPhongMaterial(that.selector_back_colors));\n      this.pane.receiveShadow = true;\n      this.pane.position.set(0, 0, 1);\n      this.scene.add(this.pane);\n      var mouse_captured = false;\n\n      for (var i = 0, pos = -3; i < that.known_types.length; ++i, ++pos) {\n        var dice = $t.dice['create_' + that.known_types[i]]();\n        dice.position.set(pos * step, 0, step * 0.5);\n        dice.castShadow = true;\n        dice.userData = that.known_types[i];\n        this.dices.push(dice);\n        this.scene.add(dice);\n      }\n\n      this.running = new Date().getTime();\n      this.last_time = 0;\n      if (this.animate_selector) this.__selector_animate(this.running);else this.renderer.render(this.scene, this.camera);\n    };\n\n    function throw_dices(box, vector, boost, dist, notation_getter, before_roll, after_roll) {\n      var uat = $t.dice.use_adapvite_timestep;\n\n      function roll(request_results) {\n        if (after_roll) {\n          box.clear();\n          box.roll(vectors, request_results || notation.result, function (result) {\n            if (after_roll) after_roll.call(box, notation, result);\n            box.rolling = false;\n            $t.dice.use_adapvite_timestep = uat;\n          });\n        }\n      }\n\n      vector.x /= dist;\n      vector.y /= dist;\n      var notation = notation_getter.call(box);\n      if (notation.set.length == 0) return;\n      var vectors = box.generate_vectors(notation, vector, boost);\n      box.rolling = true;\n      if (before_roll) before_roll.call(box, vectors, notation, roll);else roll();\n    }\n\n    this.dice_box.prototype.bind_mouse = function (container, notation_getter, before_roll, after_roll) {\n      var box = this;\n      $t.bind(container, ['mousedown', 'touchstart'], function (ev) {\n        ev.preventDefault();\n        box.mouse_time = new Date().getTime();\n        box.mouse_start = $t.get_mouse_coords(ev);\n      });\n      $t.bind(container, ['mouseup', 'touchend'], function (ev) {\n        if (box.rolling) return;\n        if (box.mouse_start == undefined) return;\n        ev.stopPropagation();\n        var m = $t.get_mouse_coords(ev);\n        var vector = {\n          x: m.x - box.mouse_start.x,\n          y: -(m.y - box.mouse_start.y)\n        };\n        box.mouse_start = undefined;\n        var dist = Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n        if (dist < Math.sqrt(box.w * box.h * 0.01)) return;\n        var time_int = new Date().getTime() - box.mouse_time;\n        if (time_int > 2000) time_int = 2000;\n        var boost = Math.sqrt((2500 - time_int) / 2500) * dist * 2;\n        prepare_rnd(function () {\n          throw_dices(box, vector, boost, dist, notation_getter, before_roll, after_roll);\n        });\n      });\n    };\n\n    this.dice_box.prototype.bind_throw = function (button, notation_getter, before_roll, after_roll) {\n      var box = this;\n      $t.bind(button, ['mouseup', 'touchend'], function (ev) {\n        ev.stopPropagation();\n        box.start_throw(notation_getter, before_roll, after_roll);\n      });\n    };\n\n    this.dice_box.prototype.start_throw = function (notation_getter, before_roll, after_roll) {\n      var box = this;\n      if (box.rolling) return;\n      prepare_rnd(function () {\n        var vector = {\n          x: (rnd() * 2 - 1) * box.w,\n          y: -(rnd() * 2 - 1) * box.h\n        };\n        var dist = Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n        var boost = (rnd() + 3) * dist;\n        throw_dices(box, vector, boost, dist, notation_getter, before_roll, after_roll);\n      });\n    };\n  }).apply(teal.dice = teal.dice || {});\n\n  function dice_initialize(container) {\n    $t.remove($t.id('loading_text'));\n    var canvas = $t.id('canvas');\n    canvas.style.width = window.innerWidth - 1 + 'px';\n    canvas.style.height = window.innerHeight - 1 + 'px';\n    var label = $t.id('label');\n    var set = $t.id('set');\n    var selector_div = $t.id('selector_div');\n    var info_div = $t.id('info_div');\n    on_set_change();\n    $t.dice.use_true_random = false;\n\n    function on_set_change(ev) {\n      set.style.width = set.value.length + 3 + 'ex';\n    }\n\n    $t.bind(set, 'keyup', on_set_change);\n    $t.bind(set, 'mousedown', function (ev) {\n      ev.stopPropagation();\n    });\n    $t.bind(set, 'mouseup', function (ev) {\n      ev.stopPropagation();\n    });\n    $t.bind(set, 'focus', function (ev) {\n      $t.set(container, {\n        class: ''\n      });\n    });\n    $t.bind(set, 'blur', function (ev) {\n      $t.set(container, {\n        class: 'noselect'\n      });\n    });\n    $t.bind($t.id('clear'), ['mouseup', 'touchend'], function (ev) {\n      ev.stopPropagation();\n      set.value = '0';\n      on_set_change();\n    });\n    var params = $t.get_url_params();\n\n    if (params.chromakey) {\n      $t.dice.desk_color = 0x00ff00;\n      info_div.style.display = 'none';\n      $t.id('control_panel').style.display = 'none';\n    }\n\n    if (params.shadows == 0) {\n      $t.dice.use_shadows = false;\n    }\n\n    if (params.color == 'white') {\n      $t.dice.dice_color = '#808080';\n      $t.dice.label_color = '#202020';\n    }\n\n    var box = new $t.dice.dice_box(canvas, {\n      w: 500,\n      h: 300\n    });\n    box.animate_selector = false;\n    $t.bind(window, 'resize', function () {\n      canvas.style.width = window.innerWidth - 1 + 'px';\n      canvas.style.height = window.innerHeight - 1 + 'px';\n      box.reinit(canvas, {\n        w: 500,\n        h: 300\n      });\n    });\n\n    function show_selector() {\n      info_div.style.display = 'none';\n      selector_div.style.display = 'inline-block';\n      box.draw_selector();\n    }\n\n    function before_roll(vectors, notation, callback) {\n      info_div.style.display = 'none';\n      selector_div.style.display = 'none';\n      callback();\n    }\n\n    function notation_getter() {\n      return $t.dice.parse_notation(set.value);\n    }\n\n    function after_roll(notation, result) {\n      if (params.chromakey || params.noresult) return;\n      var res = result.join(' ');\n\n      if (notation.constant) {\n        if (notation.constant > 0) res += ' +' + notation.constant;else res += ' -' + Math.abs(notation.constant);\n      }\n\n      if (result.length > 1) res += ' = ' + (result.reduce(function (s, a) {\n        return s + a;\n      }) + notation.constant);\n      label.innerHTML = res;\n      info_div.style.display = 'inline-block';\n    }\n\n    box.bind_mouse(container, notation_getter, before_roll, after_roll);\n    box.bind_throw($t.id('throw'), notation_getter, before_roll, after_roll);\n    $t.bind(container, ['mouseup', 'touchend'], function (ev) {\n      ev.stopPropagation();\n\n      if (selector_div.style.display == 'none') {\n        if (!box.rolling) show_selector();\n        box.rolling = false;\n        return;\n      }\n\n      var name = box.search_dice_by_mouse(ev);\n\n      if (name != undefined) {\n        var notation = $t.dice.parse_notation(set.value);\n        notation.set.push(name);\n        set.value = $t.dice.stringify_notation(notation);\n        on_set_change();\n      }\n    });\n\n    if (params.notation) {\n      set.value = params.notation;\n    }\n\n    if (params.roll) {\n      $t.raise_event($t.id('throw'), 'mouseup');\n    } else {\n      show_selector();\n    }\n  }\n\n  useEffect(function () {\n    dice_initialize(document.querySelector('[data-dice-body]'));\n  }, []);\n\n  function handleInput(e) {}\n\n  return _jsxs(\"div\", {\n    \"data-dice-body\": true,\n    style: {\n      margin: \"0\"\n    },\n    children: [_jsxs(\"div\", {\n      id: \"control_panel\",\n      className: \"control_panel\",\n      children: [_jsxs(\"h6\", {\n        children: [_jsx(\"img\", {\n          src: \"../favicon.ico\",\n          style: {\n            verticalAlign: \"middle\"\n          }\n        }), \" \", _jsx(\"a\", {\n          href: \"..\",\n          children: \"teal\"\n        }), \" dice\"]\n      }), _jsx(\"p\", {\n        id: \"loading_text\",\n        children: \"Loading libraries, please wait a bit...\"\n      }), _jsx(\"p\", {\n        id: \"info_text\",\n        children: _jsx(\"a\", {\n          href: \"http://www.teall.info/2014/01/online-3d-dice-roller.html\",\n          children: \"More info and help\"\n        })\n      }), _jsx(\"p\", {\n        id: \"info_text\",\n        children: _jsx(\"a\", {\n          href: \"/mdice\",\n          children: \"Multiplayer version\"\n        })\n      })]\n    }), _jsxs(\"div\", {\n      id: \"info_div\",\n      style: {\n        display: \"none\"\n      },\n      children: [_jsx(\"div\", {\n        className: \"center_field\",\n        children: _jsx(\"span\", {\n          id: \"label\"\n        })\n      }), _jsx(\"div\", {\n        className: \"center_field\",\n        children: _jsx(\"div\", {\n          className: \"bottom_field\",\n          children: _jsx(\"span\", {\n            id: \"labelhelp\",\n            children: \"click to continue or tap and drag again\"\n          })\n        })\n      })]\n    }), _jsxs(\"div\", {\n      id: \"selector_div\",\n      style: {\n        display: \"none\"\n      },\n      children: [_jsx(\"div\", {\n        className: \"center_field\",\n        children: _jsxs(\"div\", {\n          id: \"sethelp\",\n          children: [\"choose your dice set by clicking the dices or by direct input of notation,\", _jsx(\"br\", {}), \"tap and drag on free space of screen or hit throw button to roll\"]\n        })\n      }), _jsxs(\"div\", {\n        className: \"center_field\",\n        children: [_jsx(\"input\", {\n          type: \"text\",\n          id: \"set\",\n          value: \"4d6\",\n          onChange: function onChange(e) {\n            return handleInput(e.target.value);\n          }\n        }), _jsx(\"br\", {}), _jsx(\"button\", {\n          id: \"clear\",\n          children: \"clear\"\n        }), _jsx(\"button\", {\n          style: {\n            marginLeft: \"0.6em\"\n          },\n          id: \"throw\",\n          children: \"throw\"\n        })]\n      })]\n    }), _jsx(\"div\", {\n      id: \"canvas\"\n    })]\n  });\n}","map":{"version":3,"names":["$","useEffect","THREE","CANNON","DiceReact","window","teal","$t","copyto","obj","res","Array","i","length","copy","hasOwnProperty","constructor","element","name","props","place","content","dom","document","createElement","setAttribute","appendChild","undefined","inner","sel","nodeName","createTextNode","id","getElementById","set","clas","oldclass","newclass","oc","split","nc","classes","getAttribute","ind","indexOf","splice","push","join","empty","childNodes","removeChild","firstChild","remove","parentNode","bind","eventname","func","bubble","addEventListener","unbind","removeEventListener","one","one_func","e","call","raise_event","cancelable","evt","createEvent","initEvent","dispatchEvent","raise","params","ev","initCustomEvent","getElementsByClassName","get_elements_by_class","node","list","getElementsByTagName","cl","result","j","search","rpc","callback","noparse","ajax","XMLHttpRequest","open","onreadystatechange","readyState","responseText","JSON","parse","send","stringify","uuid","replace","c","r","Math","random","v","toString","get_url_params","location","substring","keyvalue","decodeURI","get_mouse_coords","touches","changedTouches","x","clientX","y","clientY","deferred","solved","callbacks","args","solve","shift","apply","console","log","promise","then","arguments","done","resolve","cancel","prototype","slice","when","promises","count","dice","random_storage","use_true_random","frame_rate","prepare_rnd","method","n","random_responce","error","data","rnd","pop","create_shape","vertices","faces","radius","cv","cf","Vec3","z","ConvexPolyhedron","make_geom","tab","af","geom","Geometry","vertex","multiplyScalar","index","ii","fl","aa","PI","Face3","faceVertexUvs","Vector2","cos","sin","computeFaceNormals","boundingSphere","Sphere","Vector3","chamfer_geom","vectors","chamfer","chamfer_vectors","chamfer_faces","corner_faces","center_point","face","vv","clone","add","divideScalar","subVectors","addVectors","pairs","lastm","m","unshift","next_vertex","create_geom","fromArray","normalize","cg","cannon_shape","standart_d20_dice_face_labels","standart_d100_dice_face_labels","calc_texture_size","approx","pow","floor","create_dice_materials","face_labels","size","margin","create_text_texture","text","color","back_color","canvas","context","getContext","ts","width","height","font","fillStyle","fillRect","textAlign","textBaseline","fillText","texture","Texture","needsUpdate","materials","MeshPhongMaterial","material_options","map","label_color","dice_color","d4_labels","create_d4_materials","labels","create_d4_text","translate","rotate","create_d4_geometry","create_d6_geometry","create_d8_geometry","create_d10_geometry","a","k","h","b","create_d12_geometry","p","sqrt","q","create_d20_geometry","t","specular","shininess","shading","FlatShading","ambient_light_color","spot_light_color","selector_back_colors","emissive","desk_color","use_shadows","known_types","dice_face_range","dice_mass","dice_inertia","scale","create_d4","d4_geometry","d4_material","MeshFaceMaterial","Mesh","create_d6","d6_geometry","dice_material","create_d8","d8_geometry","create_d10","d10_geometry","create_d12","d12_geometry","create_d20","d20_geometry","create_d100","d100_material","parse_notation","notation","no","dr0","dr1","ret","constant","exec","command","parseInt","type","stringify_notation","nn","dict","abs","that","dice_box","container","dimentions","use_adapvite_timestep","animate_selector","dices","scene","Scene","world","World","renderer","WebGLRenderingContext","WebGLRenderer","antialias","CanvasRenderer","domElement","shadowMap","enabled","PCFShadowMap","setClearColor","reinit","gravity","broadphase","NaiveBroadphase","solver","iterations","ambientLight","AmbientLight","dice_body_material","Material","desk_body_material","barrier_body_material","addContactMaterial","ContactMaterial","RigidBody","Plane","barrier","quaternion","setFromAxisAngle","position","w","last_time","running","render","camera","cw","clientWidth","ch","clientHeight","aspect","min","setSize","wh","tan","PerspectiveCamera","mw","max","light","SpotLight","target","distance","castShadow","shadowCameraNear","shadowCameraFar","shadowCameraFov","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","desk","PlaneGeometry","receiveShadow","make_random_vector","vector","random_angle","vec","generate_vectors","boost","pos","projector","velvec","velocity","inertia","angle","axis","create_dice","dice_type","body","geometry","angularVelocity","linearDamping","angularDamping","check_if_throw_finished","iteration","dice_stopped","get_dice_value","closest_face","closest_angle","l","materialIndex","normal","applyQuaternion","angleTo","matindex","get_dice_values","values","emulate_throw","step","__animate","threadid","time","Date","getTime","time_diff","children","interact","tid","uat","setTimeout","requestAnimationFrame","clear","pane","box","prepare_dices_for_roll","shift_dice_faces","value","num","material","roll","__selector_animate","angle_change","rotation","search_dice_by_mouse","intersects","Raycaster","sub","intersectObjects","object","userData","draw_selector","mouse_captured","throw_dices","dist","notation_getter","before_roll","after_roll","request_results","rolling","bind_mouse","preventDefault","mouse_time","mouse_start","stopPropagation","time_int","bind_throw","button","start_throw","dice_initialize","style","innerWidth","innerHeight","label","selector_div","info_div","on_set_change","class","chromakey","display","shadows","show_selector","noresult","reduce","s","innerHTML","querySelector","handleInput","verticalAlign","marginLeft"],"sources":["/home/alex/react-dice/dice/DiceReact.js"],"sourcesContent":["\n\nimport $ from 'jquery'\nimport { useEffect } from 'react';\nimport * as THREE from './../libs/three.min.js'\nimport * as CANNON from './../libs/cannon.min.js'\n\n\n\nexport default function DiceReact() {\n\n\n    window.teal = {};\n    window.$t = window.teal;\n\n    teal.copyto = function(obj, res) {\n        if (obj == null || typeof obj !== 'object') return obj;\n        if (obj instanceof Array) {\n            for (var i = obj.length - 1; i >= 0; --i)\n                res[i] = $t.copy(obj[i]);\n        }\n        else {\n            for (var i in obj) {\n                if (obj.hasOwnProperty(i))\n                    res[i] = $t.copy(obj[i]);\n            }\n        }\n        return res;\n    }\n\n    teal.copy = function(obj) {\n        if (!obj) return obj;\n        return teal.copyto(obj, new obj.constructor());\n    }\n\n    teal.element = function(name, props, place, content) {\n        var dom = document.createElement(name);\n        if (props) for (var i in props) dom.setAttribute(i, props[i]);\n        if (place) place.appendChild(dom);\n        if (content !== undefined) $t.inner(content, dom);\n        return dom;\n    }\n\n    teal.inner = function(obj, sel) {\n        sel.appendChild(obj.nodeName != undefined ? obj : document.createTextNode(obj));\n        return sel;\n    }\n\n    teal.id = function(id) {\n        return document.getElementById(id);\n    }\n\n    teal.set = function(sel, props) {\n        for (var i in props) sel.setAttribute(i, props[i]);\n        return sel;\n    }\n\n    teal.clas = function(sel, oldclass, newclass) {\n        var oc = oldclass ? oldclass.split(/\\s+/) : [],\n            nc = newclass ? newclass.split(/\\s+/) : [],\n            classes = (sel.getAttribute('class') || '').split(/\\s+/);\n        if (!classes[0]) classes = [];\n        for (var i in oc) {\n            var ind = classes.indexOf(oc[i]);\n            if (ind >= 0) classes.splice(ind, 1);\n        }\n        for (var i in nc) {\n            if (nc[i] && classes.indexOf(nc[i]) < 0) classes.push(nc[i]);\n        }\n        sel.setAttribute('class', classes.join(' '));\n    }\n\n    teal.empty = function(sel) {\n        if (sel.childNodes)\n            while (sel.childNodes.length)\n                sel.removeChild(sel.firstChild);\n    }\n\n    teal.remove = function(sel) {\n        if (sel) {\n            if (sel.parentNode) sel.parentNode.removeChild(sel);\n            else for (var i = sel.length - 1; i >= 0; --i)\n                sel[i].parentNode.removeChild(sel[i]);\n        }\n    }\n\n    teal.bind = function(sel, eventname, func, bubble) {\n        if (!sel) return;\n        if (eventname.constructor === Array) {\n            for (var i in eventname)\n                sel.addEventListener(eventname[i], func, bubble ? bubble : false);\n        }\n        else\n            sel.addEventListener(eventname, func, bubble ? bubble : false);\n    }\n\n    teal.unbind = function(sel, eventname, func, bubble) {\n        if (eventname.constructor === Array) {\n            for (var i in eventname)\n                sel.removeEventListener(eventname[i], func, bubble ? bubble : false);\n        }\n        else\n            sel.removeEventListener(eventname, func, bubble ? bubble : false);\n    }\n\n    teal.one = function(sel, eventname, func, bubble) {\n        var one_func = function(e) {\n            func.call(this, e);\n            teal.unbind(sel, eventname, one_func, bubble);\n        };\n        teal.bind(sel, eventname, one_func, bubble);\n    }\n\n    teal.raise_event = function(sel, eventname, bubble, cancelable) {\n        var evt = document.createEvent('UIEvents');\n        evt.initEvent(eventname, bubble == undefined ? true : bubble,\n                cancelable == undefined ? true : cancelable);\n        sel.dispatchEvent(evt);\n    }\n\n    teal.raise = function(sel, eventname, params, bubble, cancelable) {\n        var ev = document.createEvent(\"CustomEvent\");\n        ev.initCustomEvent(eventname, bubble, cancelable, params);\n        sel.dispatchEvent(ev);\n    }\n\n    if (!document.getElementsByClassName) {\n        teal.get_elements_by_class = function(classes, node) {\n            var node = node || document,\n                list = node.getElementsByTagName('*'),\n                cl = classes.split(/\\s+/),\n                result = [];\n\n            for (var i = list.length - 1; i >= 0; --i) {\n                for (var j = cl.length - 1; j >= 0; --j) {\n                    var clas = list[i].getAttribute('class');\n                    if (clas && clas.search('\\\\b' + cl[j] + '\\\\b') != -1) {\n                        result.push(list[i]);\n                        break;\n                    }\n                }\n            }\n            return result;\n        }\n    }\n    else {\n        teal.get_elements_by_class = function(classes, node) {\n            return (node || document).getElementsByClassName(classes);\n        }\n    }\n\n    teal.rpc = function(params, callback, noparse) {\n        var ajax = new XMLHttpRequest();\n        ajax.open(\"post\", 'f', true);\n        ajax.onreadystatechange = function() {\n            if (ajax.readyState == 4)\n                callback.call(ajax, noparse ? ajax.responseText : JSON.parse(ajax.responseText));\n        };\n        ajax.send(JSON.stringify(params));\n    }\n\n    teal.uuid = function() {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    }\n\n    teal.get_url_params = function() {\n        var params = window.location.search.substring(1).split(\"&\");\n        var res = {};\n        for (var i in params) {\n            var keyvalue = params[i].split(\"=\");\n            res[keyvalue[0]] = decodeURI(keyvalue[1]);\n        }\n        return res;\n    }\n\n    teal.get_mouse_coords = function(ev) {\n        var touches = ev.changedTouches;\n        if (touches) return { x: touches[0].clientX, y: touches[0].clientY };\n        return { x: ev.clientX, y: ev.clientY };\n    }\n\n    teal.deferred = function() {\n        var solved = false, callbacks = [], args = [];\n        function solve() {\n            while (callbacks.length) {\n                callbacks.shift().apply(this, args);\n            }\n        }\n        console.log('hello')\n        return {\n            promise: function() {\n                \n                return {\n                    then: function(callback) {\n                        var deferred = teal.deferred(), promise = deferred.promise();\n                        callbacks.push(function() { \n                            var res = callback.apply(this, arguments);\n                            if (res && 'done' in res) res.done(deferred.resolve);\n                            else deferred.resolve.apply(this, arguments); \n                        });\n                        return promise;\n                    },\n                    done: function(callback) {\n                        callbacks.push(callback);\n                        if (solved) solve();\n                        return this;\n                    },\n                    cancel: function() {\n                        callbacks = [];\n                    }\n                };\n            },\n            resolve: function() {\n                solved = true;\n                args = Array.prototype.slice.call(arguments, 0);\n                solve();\n            }\n        };\n    }\n\n    teal.when = function(promises) {\n        var deferred = teal.deferred();\n        var count = promises.length, ind = 0;\n        if (count == 0) deferred.resolve();\n\n        for (var i = 0; i < count; ++i) {\n            console.log(promises)\n            console.log(i)\n            promises[i].done(function() {\n                if (++ind == count) deferred.resolve();\n            });\n            \n            \n        }\n        return deferred.promise();\n    }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n(function(dice) {\n\n    var random_storage = [];\n    this.use_true_random = true;\n    this.frame_rate = 1 / 60;\n\n    function prepare_rnd(callback) {\n        if (!random_storage.length && $t.dice.use_true_random) {\n            try {\n                $t.rpc({ method: \"random\", n: 512 }, \n                function(random_responce) {\n                    if (!random_responce.error)\n                        random_storage = random_responce.result.random.data;\n                    else $t.dice.use_true_random = false;\n                    callback();\n                });\n                return;\n            }\n            catch (e) { $t.dice.use_true_random = false; }\n        }\n        callback();\n    }\n\n    function rnd() {\n        return random_storage.length ? random_storage.pop() : Math.random();\n    }\n\n    function create_shape(vertices, faces, radius) {\n        var cv = new Array(vertices.length), cf = new Array(faces.length);\n        for (var i = 0; i < vertices.length; ++i) {\n            var v = vertices[i];\n            cv[i] = new CANNON.Vec3(v.x * radius, v.y * radius, v.z * radius);\n        }\n        for (var i = 0; i < faces.length; ++i) {\n            cf[i] = faces[i].slice(0, faces[i].length - 1);\n        }\n        return new CANNON.ConvexPolyhedron(cv, cf);\n    }\n\n    function make_geom(vertices, faces, radius, tab, af) {\n        var geom = new THREE.Geometry();\n        for (var i = 0; i < vertices.length; ++i) {\n            var vertex = vertices[i].multiplyScalar(radius);\n            vertex.index = geom.vertices.push(vertex) - 1;\n        }\n        for (var i = 0; i < faces.length; ++i) {\n            var ii = faces[i], fl = ii.length - 1;\n            var aa = Math.PI * 2 / fl;\n            for (var j = 0; j < fl - 2; ++j) {\n                geom.faces.push(new THREE.Face3(ii[0], ii[j + 1], ii[j + 2], [geom.vertices[ii[0]],\n                            geom.vertices[ii[j + 1]], geom.vertices[ii[j + 2]]], 0, ii[fl] + 1));\n                geom.faceVertexUvs[0].push([\n                        new THREE.Vector2((Math.cos(af) + 1 + tab) / 2 / (1 + tab),\n                            (Math.sin(af) + 1 + tab) / 2 / (1 + tab)),\n                        new THREE.Vector2((Math.cos(aa * (j + 1) + af) + 1 + tab) / 2 / (1 + tab),\n                            (Math.sin(aa * (j + 1) + af) + 1 + tab) / 2 / (1 + tab)),\n                        new THREE.Vector2((Math.cos(aa * (j + 2) + af) + 1 + tab) / 2 / (1 + tab),\n                            (Math.sin(aa * (j + 2) + af) + 1 + tab) / 2 / (1 + tab))]);\n            }\n        }\n        geom.computeFaceNormals();\n        geom.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\n        return geom;\n    }\n\n    function chamfer_geom(vectors, faces, chamfer) {\n        var chamfer_vectors = [], chamfer_faces = [], corner_faces = new Array(vectors.length);\n        for (var i = 0; i < vectors.length; ++i) corner_faces[i] = [];\n        for (var i = 0; i < faces.length; ++i) {\n            var ii = faces[i], fl = ii.length - 1;\n            var center_point = new THREE.Vector3();\n            var face = new Array(fl);\n            for (var j = 0; j < fl; ++j) {\n                var vv = vectors[ii[j]].clone();\n                center_point.add(vv);\n                corner_faces[ii[j]].push(face[j] = chamfer_vectors.push(vv) - 1);\n            }\n            center_point.divideScalar(fl);\n            for (var j = 0; j < fl; ++j) {\n                var vv = chamfer_vectors[face[j]];\n                vv.subVectors(vv, center_point).multiplyScalar(chamfer).addVectors(vv, center_point);\n            }\n            face.push(ii[fl]);\n            chamfer_faces.push(face);\n        }\n        for (var i = 0; i < faces.length - 1; ++i) {\n            for (var j = i + 1; j < faces.length; ++j) {\n                var pairs = [], lastm = -1;\n                for (var m = 0; m < faces[i].length - 1; ++m) {\n                    var n = faces[j].indexOf(faces[i][m]);\n                    if (n >= 0 && n < faces[j].length - 1) {\n                        if (lastm >= 0 && m != lastm + 1) pairs.unshift([i, m], [j, n]);\n                        else pairs.push([i, m], [j, n]);\n                        lastm = m;\n                    }\n                }\n                if (pairs.length != 4) continue;\n                chamfer_faces.push([chamfer_faces[pairs[0][0]][pairs[0][1]],\n                        chamfer_faces[pairs[1][0]][pairs[1][1]],\n                        chamfer_faces[pairs[3][0]][pairs[3][1]],\n                        chamfer_faces[pairs[2][0]][pairs[2][1]], -1]);\n            }\n        }\n        for (var i = 0; i < corner_faces.length; ++i) {\n            var cf = corner_faces[i], face = [cf[0]], count = cf.length - 1;\n            while (count) {\n                for (var m = faces.length; m < chamfer_faces.length; ++m) {\n                    var index = chamfer_faces[m].indexOf(face[face.length - 1]);\n                    if (index >= 0 && index < 4) {\n                        if (--index == -1) index = 3;\n                        var next_vertex = chamfer_faces[m][index];\n                        if (cf.indexOf(next_vertex) >= 0) {\n                            face.push(next_vertex);\n                            break;\n                        }\n                    }\n                }\n                --count;\n            }\n            face.push(-1);\n            chamfer_faces.push(face);\n        }\n        return { vectors: chamfer_vectors, faces: chamfer_faces };\n    }\n\n    function create_geom(vertices, faces, radius, tab, af, chamfer) {\n        var vectors = new Array(vertices.length);\n        for (var i = 0; i < vertices.length; ++i) {\n            vectors[i] = (new THREE.Vector3).fromArray(vertices[i]).normalize();\n        }\n        var cg = chamfer_geom(vectors, faces, chamfer);\n        var geom = make_geom(cg.vectors, cg.faces, radius, tab, af);\n        //var geom = make_geom(vectors, faces, radius, tab, af); // Without chamfer\n        geom.cannon_shape = create_shape(vectors, faces, radius);\n        return geom;\n    }\n\n    this.standart_d20_dice_face_labels = [' ', '0', '1', '2', '3', '4', '5', '6', '7', '8',\n            '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20'];\n    this.standart_d100_dice_face_labels = [' ', '00', '10', '20', '30', '40', '50',\n            '60', '70', '80', '90'];\n\n    function calc_texture_size(approx) {\n        return Math.pow(2, Math.floor(Math.log(approx) / Math.log(2)));\n    }\n\n    this.create_dice_materials = function(face_labels, size, margin) {\n        function create_text_texture(text, color, back_color) {\n            if (text == undefined) return null;\n            var canvas = document.createElement(\"canvas\");\n            var context = canvas.getContext(\"2d\");\n            var ts = calc_texture_size(size + size * 2 * margin) * 2;\n            canvas.width = canvas.height = ts;\n            context.font = ts / (1 + 2 * margin) + \"pt Arial\";\n            context.fillStyle = back_color;\n            context.fillRect(0, 0, canvas.width, canvas.height);\n            context.textAlign = \"center\";\n            context.textBaseline = \"middle\";\n            context.fillStyle = color;\n            context.fillText(text, canvas.width / 2, canvas.height / 2);\n            if (text == '6' || text == '9') {\n                context.fillText('  .', canvas.width / 2, canvas.height / 2);\n            }\n            var texture = new THREE.Texture(canvas);\n            texture.needsUpdate = true;\n            return texture;\n        }\n        var materials = [];\n        for (var i = 0; i < face_labels.length; ++i)\n            materials.push(new THREE.MeshPhongMaterial($t.copyto(this.material_options,\n                        { map: create_text_texture(face_labels[i], this.label_color, this.dice_color) })));\n        return materials;\n    }\n\n    var d4_labels = [\n        [[], [0, 0, 0], [2, 4, 3], [1, 3, 4], [2, 1, 4], [1, 2, 3]],\n        [[], [0, 0, 0], [2, 3, 4], [3, 1, 4], [2, 4, 1], [3, 2, 1]],\n        [[], [0, 0, 0], [4, 3, 2], [3, 4, 1], [4, 2, 1], [3, 1, 2]],\n        [[], [0, 0, 0], [4, 2, 3], [1, 4, 3], [4, 1, 2], [1, 3, 2]]\n    ];\n\n    this.create_d4_materials = function(size, margin, labels) {\n        function create_d4_text(text, color, back_color) {\n            var canvas = document.createElement(\"canvas\");\n            var context = canvas.getContext(\"2d\");\n            var ts = calc_texture_size(size + margin) * 2;\n            canvas.width = canvas.height = ts;\n            context.font = (ts - margin) / 1.5 + \"pt Arial\";\n            context.fillStyle = back_color;\n            context.fillRect(0, 0, canvas.width, canvas.height);\n            context.textAlign = \"center\";\n            context.textBaseline = \"middle\";\n            context.fillStyle = color;\n            for (var i in text) {\n                context.fillText(text[i], canvas.width / 2,\n                        canvas.height / 2 - ts * 0.3);\n                context.translate(canvas.width / 2, canvas.height / 2);\n                context.rotate(Math.PI * 2 / 3);\n                context.translate(-canvas.width / 2, -canvas.height / 2);\n            }\n            var texture = new THREE.Texture(canvas);\n            texture.needsUpdate = true;\n            return texture;\n        }\n        var materials = [];\n        for (var i = 0; i < labels.length; ++i)\n            materials.push(new THREE.MeshPhongMaterial($t.copyto(this.material_options,\n                        { map: create_d4_text(labels[i], this.label_color, this.dice_color) })));\n        return materials;\n    }\n\n    this.create_d4_geometry = function(radius) {\n        var vertices = [[1, 1, 1], [-1, -1, 1], [-1, 1, -1], [1, -1, -1]];\n        var faces = [[1, 0, 2, 1], [0, 1, 3, 2], [0, 3, 2, 3], [1, 2, 3, 4]];\n        return create_geom(vertices, faces, radius, -0.1, Math.PI * 7 / 6, 0.96);\n    }\n\n    this.create_d6_geometry = function(radius) {\n        var vertices = [[-1, -1, -1], [1, -1, -1], [1, 1, -1], [-1, 1, -1],\n                [-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]];\n        var faces = [[0, 3, 2, 1, 1], [1, 2, 6, 5, 2], [0, 1, 5, 4, 3],\n                [3, 7, 6, 2, 4], [0, 4, 7, 3, 5], [4, 5, 6, 7, 6]];\n        return create_geom(vertices, faces, radius, 0.1, Math.PI / 4, 0.96);\n    }\n\n    this.create_d8_geometry = function(radius) {\n        var vertices = [[1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0], [0, 0, 1], [0, 0, -1]];\n        var faces = [[0, 2, 4, 1], [0, 4, 3, 2], [0, 3, 5, 3], [0, 5, 2, 4], [1, 3, 4, 5],\n                [1, 4, 2, 6], [1, 2, 5, 7], [1, 5, 3, 8]];\n        return create_geom(vertices, faces, radius, 0, -Math.PI / 4 / 2, 0.965);\n    }\n\n    this.create_d10_geometry = function(radius) {\n        var a = Math.PI * 2 / 10, k = Math.cos(a), h = 0.105, v = -1;\n        var vertices = [];\n        for (var i = 0, b = 0; i < 10; ++i, b += a)\n            vertices.push([Math.cos(b), Math.sin(b), h * (i % 2 ? 1 : -1)]);\n        vertices.push([0, 0, -1]); vertices.push([0, 0, 1]);\n        var faces = [[5, 7, 11, 0], [4, 2, 10, 1], [1, 3, 11, 2], [0, 8, 10, 3], [7, 9, 11, 4],\n                [8, 6, 10, 5], [9, 1, 11, 6], [2, 0, 10, 7], [3, 5, 11, 8], [6, 4, 10, 9],\n                [1, 0, 2, v], [1, 2, 3, v], [3, 2, 4, v], [3, 4, 5, v], [5, 4, 6, v],\n                [5, 6, 7, v], [7, 6, 8, v], [7, 8, 9, v], [9, 8, 0, v], [9, 0, 1, v]];\n        return create_geom(vertices, faces, radius, 0, Math.PI * 6 / 5, 0.945);\n    }\n\n    this.create_d12_geometry = function(radius) {\n        var p = (1 + Math.sqrt(5)) / 2, q = 1 / p;\n        var vertices = [[0, q, p], [0, q, -p], [0, -q, p], [0, -q, -p], [p, 0, q],\n                [p, 0, -q], [-p, 0, q], [-p, 0, -q], [q, p, 0], [q, -p, 0], [-q, p, 0],\n                [-q, -p, 0], [1, 1, 1], [1, 1, -1], [1, -1, 1], [1, -1, -1], [-1, 1, 1],\n                [-1, 1, -1], [-1, -1, 1], [-1, -1, -1]];\n        var faces = [[2, 14, 4, 12, 0, 1], [15, 9, 11, 19, 3, 2], [16, 10, 17, 7, 6, 3], [6, 7, 19, 11, 18, 4],\n                [6, 18, 2, 0, 16, 5], [18, 11, 9, 14, 2, 6], [1, 17, 10, 8, 13, 7], [1, 13, 5, 15, 3, 8],\n                [13, 8, 12, 4, 5, 9], [5, 4, 14, 9, 15, 10], [0, 12, 8, 10, 16, 11], [3, 19, 7, 17, 1, 12]];\n        return create_geom(vertices, faces, radius, 0.2, -Math.PI / 4 / 2, 0.968);\n    }\n\n    this.create_d20_geometry = function(radius) {\n        var t = (1 + Math.sqrt(5)) / 2;\n        var vertices = [[-1, t, 0], [1, t, 0 ], [-1, -t, 0], [1, -t, 0],\n                [0, -1, t], [0, 1, t], [0, -1, -t], [0, 1, -t],\n                [t, 0, -1], [t, 0, 1], [-t, 0, -1], [-t, 0, 1]];\n        var faces = [[0, 11, 5, 1], [0, 5, 1, 2], [0, 1, 7, 3], [0, 7, 10, 4], [0, 10, 11, 5],\n                [1, 5, 9, 6], [5, 11, 4, 7], [11, 10, 2, 8], [10, 7, 6, 9], [7, 1, 8, 10],\n                [3, 9, 4, 11], [3, 4, 2, 12], [3, 2, 6, 13], [3, 6, 8, 14], [3, 8, 9, 15],\n                [4, 9, 5, 16], [2, 4, 11, 17], [6, 2, 10, 18], [8, 6, 7, 19], [9, 8, 1, 20]];\n        return create_geom(vertices, faces, radius, -0.2, -Math.PI / 4 / 2, 0.955);\n    }\n\n    this.material_options = {\n        specular: 0x172022,\n        color: 0xf0f0f0,\n        shininess: 40,\n        shading: THREE.FlatShading,\n    };\n    this.label_color = '#aaaaaa';\n    this.dice_color = '#202020';\n    this.ambient_light_color = 0xf0f5fb;\n    this.spot_light_color = 0xefdfd5;\n    this.selector_back_colors = { color: 0x404040, shininess: 0, emissive: 0x858787 };\n    this.desk_color = 0xdfdfdf;\n    this.use_shadows = true;\n\n    this.known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];\n    this.dice_face_range = { 'd4': [1, 4], 'd6': [1, 6], 'd8': [1, 8], 'd10': [0, 9], \n        'd12': [1, 12], 'd20': [1, 20], 'd100': [0, 9] };\n    this.dice_mass = { 'd4': 300, 'd6': 300, 'd8': 340, 'd10': 350, 'd12': 350, 'd20': 400, 'd100': 350 };\n    this.dice_inertia = { 'd4': 5, 'd6': 13, 'd8': 10, 'd10': 9, 'd12': 8, 'd20': 6, 'd100': 9 };\n\n    this.scale = 50;\n\n    this.create_d4 = function() {\n        if (!this.d4_geometry) this.d4_geometry = this.create_d4_geometry(this.scale * 1.2);\n        if (!this.d4_material) this.d4_material = new THREE.MeshFaceMaterial(\n                this.create_d4_materials(this.scale / 2, this.scale * 2, d4_labels[0]));\n        return new THREE.Mesh(this.d4_geometry, this.d4_material);\n    }\n\n    this.create_d6 = function() {\n        if (!this.d6_geometry) this.d6_geometry = this.create_d6_geometry(this.scale * 0.9);\n        if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(\n                this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n        return new THREE.Mesh(this.d6_geometry, this.dice_material);\n    }\n\n    this.create_d8 = function() {\n        if (!this.d8_geometry) this.d8_geometry = this.create_d8_geometry(this.scale);\n        if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(\n                this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.2));\n        return new THREE.Mesh(this.d8_geometry, this.dice_material);\n    }\n\n    this.create_d10 = function() {\n        if (!this.d10_geometry) this.d10_geometry = this.create_d10_geometry(this.scale * 0.9);\n        if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(\n                this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n        return new THREE.Mesh(this.d10_geometry, this.dice_material);\n    }\n\n    this.create_d12 = function() {\n        if (!this.d12_geometry) this.d12_geometry = this.create_d12_geometry(this.scale * 0.9);\n        if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(\n                this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n        return new THREE.Mesh(this.d12_geometry, this.dice_material);\n    }\n\n    this.create_d20 = function() {\n        if (!this.d20_geometry) this.d20_geometry = this.create_d20_geometry(this.scale);\n        if (!this.dice_material) this.dice_material = new THREE.MeshFaceMaterial(\n                this.create_dice_materials(this.standart_d20_dice_face_labels, this.scale / 2, 1.0));\n        return new THREE.Mesh(this.d20_geometry, this.dice_material);\n    }\n\n    this.create_d100 = function() {\n        if (!this.d10_geometry) this.d10_geometry = this.create_d10_geometry(this.scale * 0.9);\n        if (!this.d100_material) this.d100_material = new THREE.MeshFaceMaterial(\n                this.create_dice_materials(this.standart_d100_dice_face_labels, this.scale / 2, 1.5));\n        return new THREE.Mesh(this.d10_geometry, this.d100_material);\n    }\n\n    this.parse_notation = function(notation) {\n        var no = notation.split('@');\n        var dr0 = /\\s*(\\d*)([a-z]+)(\\d+)(\\s*(\\+|\\-)\\s*(\\d+)){0,1}\\s*(\\+|$)/gi;\n        var dr1 = /(\\b)*(\\d+)(\\b)*/gi;\n        var ret = { set: [], constant: 0, result: [], error: false }, res;\n        while (res = dr0.exec(no[0])) {\n            var command = res[2];\n            if (command != 'd') { ret.error = true; continue; }\n            var count = parseInt(res[1]);\n            if (res[1] == '') count = 1;\n            var type = 'd' + res[3];\n            if (this.known_types.indexOf(type) == -1) { ret.error = true; continue; }\n            while (count--) ret.set.push(type);\n            if (res[5] && res[6]) {\n                if (res[5] == '+') ret.constant += parseInt(res[6]);\n                else ret.constant -= parseInt(res[6]);\n            }\n        }\n        while (res = dr1.exec(no[1])) {\n            ret.result.push(parseInt(res[2]));\n        }\n        return ret;\n    }\n\n    this.stringify_notation = function(nn) {\n        var dict = {}, notation = '';\n        for (var i in nn.set) \n            if (!dict[nn.set[i]]) dict[nn.set[i]] = 1; else ++dict[nn.set[i]];\n        for (var i in dict) {\n            if (notation.length) notation += ' + ';\n            notation += (dict[i] > 1 ? dict[i] : '') + i;\n        }\n        if (nn.constant) {\n            if (nn.constant > 0) notation += ' + ' + nn.constant;\n            else notation += ' - ' + Math.abs(nn.constant);\n        }\n        return notation;\n    }\n\n    var that = this;\n\n    this.dice_box = function(container, dimentions) {\n        this.use_adapvite_timestep = true;\n        this.animate_selector = true;\n\n        this.dices = [];\n        this.scene = new THREE.Scene();\n        this.world = new CANNON.World();\n\n        this.renderer = window.WebGLRenderingContext\n            ? new THREE.WebGLRenderer({ antialias: true })\n            : new THREE.CanvasRenderer({ antialias: true });\n        container.appendChild(this.renderer.domElement);\n        this.renderer.shadowMap.enabled = true;\n        this.renderer.shadowMap.type = THREE.PCFShadowMap;\n        this.renderer.setClearColor(0xffffff, 1);\n\n        this.reinit(container, dimentions);\n\n        this.world.gravity.set(0, 0, -9.8 * 800);\n        this.world.broadphase = new CANNON.NaiveBroadphase();\n        this.world.solver.iterations = 16;\n\n        var ambientLight = new THREE.AmbientLight(that.ambient_light_color);\n        this.scene.add(ambientLight);\n\n        this.dice_body_material = new CANNON.Material();\n        var desk_body_material = new CANNON.Material();\n        var barrier_body_material = new CANNON.Material();\n        this.world.addContactMaterial(new CANNON.ContactMaterial(\n                    desk_body_material, this.dice_body_material, 0.01, 0.5));\n        this.world.addContactMaterial(new CANNON.ContactMaterial(\n                    barrier_body_material, this.dice_body_material, 0, 1.0));\n        this.world.addContactMaterial(new CANNON.ContactMaterial(\n                    this.dice_body_material, this.dice_body_material, 0, 0.5));\n\n        this.world.add(new CANNON.RigidBody(0, new CANNON.Plane(), desk_body_material));\n        var barrier;\n        barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n        barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), Math.PI / 2);\n        barrier.position.set(0, this.h * 0.93, 0);\n        this.world.add(barrier);\n\n        barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n        barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);\n        barrier.position.set(0, -this.h * 0.93, 0);\n        this.world.add(barrier);\n\n        barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n        barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(0, 1, 0), -Math.PI / 2);\n        barrier.position.set(this.w * 0.93, 0, 0);\n        this.world.add(barrier);\n\n        barrier = new CANNON.RigidBody(0, new CANNON.Plane(), barrier_body_material);\n        barrier.quaternion.setFromAxisAngle(new CANNON.Vec3(0, 1, 0), Math.PI / 2);\n        barrier.position.set(-this.w * 0.93, 0, 0);\n        this.world.add(barrier);\n\n        this.last_time = 0;\n        this.running = false;\n\n        this.renderer.render(this.scene, this.camera);\n    }\n\n    this.dice_box.prototype.reinit = function(container, dimentions) {\n        this.cw = container.clientWidth / 2;\n        this.ch = container.clientHeight / 2;\n        if (dimentions) {\n            this.w = dimentions.w;\n            this.h = dimentions.h;\n        }\n        else {\n            this.w = this.cw;\n            this.h = this.ch;\n        }\n        this.aspect = Math.min(this.cw / this.w, this.ch / this.h);\n        that.scale = Math.sqrt(this.w * this.w + this.h * this.h) / 13;\n\n        this.renderer.setSize(this.cw * 2, this.ch * 2);\n\n        this.wh = this.ch / this.aspect / Math.tan(10 * Math.PI / 180);\n        if (this.camera) this.scene.remove(this.camera);\n        this.camera = new THREE.PerspectiveCamera(20, this.cw / this.ch, 1, this.wh * 1.3);\n        this.camera.position.z = this.wh;\n\n        var mw = Math.max(this.w, this.h);\n        if (this.light) this.scene.remove(this.light);\n        this.light = new THREE.SpotLight(that.spot_light_color, 2.0);\n        this.light.position.set(-mw / 2, mw / 2, mw * 2);\n        this.light.target.position.set(0, 0, 0);\n        this.light.distance = mw * 5;\n        this.light.castShadow = true;\n        this.light.shadowCameraNear = mw / 10;\n        this.light.shadowCameraFar = mw * 5;\n        this.light.shadowCameraFov = 50;\n        this.light.shadowBias = 0.001;\n        this.light.shadowDarkness = 1.1;\n        this.light.shadowMapWidth = 1024;\n        this.light.shadowMapHeight = 1024;\n        this.scene.add(this.light);\n\n        if (this.desk) this.scene.remove(this.desk);\n        this.desk = new THREE.Mesh(new THREE.PlaneGeometry(this.w * 2, this.h * 2, 1, 1), \n                new THREE.MeshPhongMaterial({ color: that.desk_color }));\n        this.desk.receiveShadow = that.use_shadows;\n        this.scene.add(this.desk);\n\n        this.renderer.render(this.scene, this.camera);\n    }\n\n    function make_random_vector(vector) {\n        var random_angle = rnd() * Math.PI / 5 - Math.PI / 5 / 2;\n        var vec = {\n            x: vector.x * Math.cos(random_angle) - vector.y * Math.sin(random_angle),\n            y: vector.x * Math.sin(random_angle) + vector.y * Math.cos(random_angle)\n        };\n        if (vec.x == 0) vec.x = 0.01;\n        if (vec.y == 0) vec.y = 0.01;\n        return vec;\n    }\n\n    this.dice_box.prototype.generate_vectors = function(notation, vector, boost) {\n        var vectors = [];\n        for (var i in notation.set) {\n            var vec = make_random_vector(vector);\n            var pos = {\n                x: this.w * (vec.x > 0 ? -1 : 1) * 0.9,\n                y: this.h * (vec.y > 0 ? -1 : 1) * 0.9,\n                z: rnd() * 200 + 200\n            };\n            var projector = Math.abs(vec.x / vec.y);\n            if (projector > 1.0) pos.y /= projector; else pos.x *= projector;\n            var velvec = make_random_vector(vector);\n            var velocity = { x: velvec.x * boost, y: velvec.y * boost, z: -10 };\n            var inertia = that.dice_inertia[notation.set[i]];\n            var angle = {\n                x: -(rnd() * vec.y * 5 + inertia * vec.y),\n                y: rnd() * vec.x * 5 + inertia * vec.x,\n                z: 0\n            };\n            var axis = { x: rnd(), y: rnd(), z: rnd(), a: rnd() };\n            vectors.push({ set: notation.set[i], pos: pos, velocity: velocity, angle: angle, axis: axis });\n        }\n        return vectors;\n    }\n\n    this.dice_box.prototype.create_dice = function(type, pos, velocity, angle, axis) {\n        var dice = that['create_' + type]();\n        dice.castShadow = true;\n        dice.dice_type = type;\n        dice.body = new CANNON.RigidBody(that.dice_mass[type],\n                dice.geometry.cannon_shape, this.dice_body_material);\n        dice.body.position.set(pos.x, pos.y, pos.z);\n        dice.body.quaternion.setFromAxisAngle(new CANNON.Vec3(axis.x, axis.y, axis.z), axis.a * Math.PI * 2);\n        dice.body.angularVelocity.set(angle.x, angle.y, angle.z);\n        dice.body.velocity.set(velocity.x, velocity.y, velocity.z);\n        dice.body.linearDamping = 0.1;\n        dice.body.angularDamping = 0.1;\n        this.scene.add(dice);\n        this.dices.push(dice);\n        this.world.add(dice.body);\n    }\n\n    this.dice_box.prototype.check_if_throw_finished = function() {\n        var res = true;\n        var e = 6;\n        if (this.iteration < 10 / that.frame_rate) {\n            for (var i = 0; i < this.dices.length; ++i) {\n                var dice = this.dices[i];\n                if (dice.dice_stopped === true) continue;\n                var a = dice.body.angularVelocity, v = dice.body.velocity;\n                if (Math.abs(a.x) < e && Math.abs(a.y) < e && Math.abs(a.z) < e &&\n                        Math.abs(v.x) < e && Math.abs(v.y) < e && Math.abs(v.z) < e) {\n                    if (dice.dice_stopped) {\n                        if (this.iteration - dice.dice_stopped > 3) {\n                            dice.dice_stopped = true;\n                            continue;\n                        }\n                    }\n                    else dice.dice_stopped = this.iteration;\n                    res = false;\n                }\n                else {\n                    dice.dice_stopped = undefined;\n                    res = false;\n                }\n            }\n        }\n        return res;\n    }\n\n    function get_dice_value(dice) {\n        var vector = new THREE.Vector3(0, 0, dice.dice_type == 'd4' ? -1 : 1);\n        var closest_face, closest_angle = Math.PI * 2;\n        for (var i = 0, l = dice.geometry.faces.length; i < l; ++i) {\n            var face = dice.geometry.faces[i];\n            if (face.materialIndex == 0) continue;\n            var angle = face.normal.clone().applyQuaternion(dice.body.quaternion).angleTo(vector);\n            if (angle < closest_angle) {\n                closest_angle = angle;\n                closest_face = face;\n            }\n        }\n        var matindex = closest_face.materialIndex - 1;\n        if (dice.dice_type == 'd100') matindex *= 10;\n        if (dice.dice_type == 'd10' && matindex == 0) matindex = 10;\n        return matindex;\n    }\n\n    function get_dice_values(dices) {\n        var values = [];\n        for (var i = 0, l = dices.length; i < l; ++i) {\n            values.push(get_dice_value(dices[i]));\n        }\n        return values;\n    }\n\n    this.dice_box.prototype.emulate_throw = function() {\n        while (!this.check_if_throw_finished()) {\n            ++this.iteration;\n            this.world.step(that.frame_rate);\n        }\n        return get_dice_values(this.dices);\n    }\n\n    this.dice_box.prototype.__animate = function(threadid) {\n        var time = (new Date()).getTime();\n        var time_diff = (time - this.last_time) / 1000;\n        if (time_diff > 3) time_diff = that.frame_rate;\n        ++this.iteration;\n        if (this.use_adapvite_timestep) {\n            while (time_diff > that.frame_rate * 1.1) {\n                this.world.step(that.frame_rate);\n                time_diff -= that.frame_rate;\n            }\n            this.world.step(time_diff);\n        }\n        else {\n            this.world.step(that.frame_rate);\n        }\n        for (var i in this.scene.children) {\n            var interact = this.scene.children[i];\n            if (interact.body != undefined) {\n                interact.position.copy(interact.body.position);\n                interact.quaternion.copy(interact.body.quaternion);\n            }\n        }\n        this.renderer.render(this.scene, this.camera);\n        this.last_time = this.last_time ? time : (new Date()).getTime();\n        if (this.running == threadid && this.check_if_throw_finished()) {\n            this.running = false;\n            if (this.callback) this.callback.call(this, get_dice_values(this.dices));\n        }\n        if (this.running == threadid) {\n            (function(t, tid, uat) {\n                if (!uat && time_diff < that.frame_rate) {\n                    setTimeout(function() { requestAnimationFrame(function() { t.__animate(tid); }); },\n                        (that.frame_rate - time_diff) * 1000);\n                }\n                else requestAnimationFrame(function() { t.__animate(tid); });\n            })(this, threadid, this.use_adapvite_timestep);\n        }\n    }\n\n    this.dice_box.prototype.clear = function() {\n        this.running = false;\n        var dice;\n        while (dice = this.dices.pop()) {\n            this.scene.remove(dice); \n            if (dice.body) this.world.remove(dice.body);\n        }\n        if (this.pane) this.scene.remove(this.pane);\n        this.renderer.render(this.scene, this.camera);\n        var box = this;\n        setTimeout(function() { box.renderer.render(box.scene, box.camera); }, 100);\n    }\n\n    this.dice_box.prototype.prepare_dices_for_roll = function(vectors) {\n        this.clear();\n        this.iteration = 0;\n        for (var i in vectors) {\n            this.create_dice(vectors[i].set, vectors[i].pos, vectors[i].velocity,\n                    vectors[i].angle, vectors[i].axis);\n        }\n    }\n\n    function shift_dice_faces(dice, value, res) {\n        var r = that.dice_face_range[dice.dice_type];\n        if (dice.dice_type == 'd10' && value == 10) value = 0;\n        if (!(value >= r[0] && value <= r[1])) return;\n        var num = value - res;\n        var geom = dice.geometry.clone();\n        for (var i = 0, l = geom.faces.length; i < l; ++i) {\n            var matindex = geom.faces[i].materialIndex;\n            if (matindex == 0) continue;\n            matindex += num - 1;\n            while (matindex > r[1]) matindex -= r[1];\n            while (matindex < r[0]) matindex += r[1];\n            geom.faces[i].materialIndex = matindex + 1;\n        }\n        if (dice.dice_type == 'd4' && num != 0) {\n            if (num < 0) num += 4;\n            dice.material = new THREE.MeshFaceMaterial(\n                    that.create_d4_materials(that.scale / 2, that.scale * 2, d4_labels[num]));\n        }\n        dice.geometry = geom;\n    }\n\n    this.dice_box.prototype.roll = function(vectors, values, callback) {\n        this.prepare_dices_for_roll(vectors);\n        if (values != undefined && values.length) {\n            this.use_adapvite_timestep = false;\n            var res = this.emulate_throw();\n            this.prepare_dices_for_roll(vectors);\n            for (var i in res)\n                shift_dice_faces(this.dices[i], values[i], res[i]);\n        }\n        this.callback = callback;\n        this.running = (new Date()).getTime();\n        this.last_time = 0;\n        this.__animate(this.running);\n    }\n\n    this.dice_box.prototype.__selector_animate = function(threadid) {\n        var time = (new Date()).getTime();\n        var time_diff = (time - this.last_time) / 1000;\n        if (time_diff > 3) time_diff = that.frame_rate;\n        var angle_change = 0.3 * time_diff * Math.PI * Math.min(24000 + threadid - time, 6000) / 6000;\n        if (angle_change < 0) this.running = false;\n        for (var i in this.dices) {\n            this.dices[i].rotation.y += angle_change;\n            this.dices[i].rotation.x += angle_change / 4;\n            this.dices[i].rotation.z += angle_change / 10;\n        }\n        this.last_time = time;\n        this.renderer.render(this.scene, this.camera);\n        if (this.running == threadid) {\n            (function(t, tid) {\n                requestAnimationFrame(function() { t.__selector_animate(tid); });\n            })(this, threadid);\n        }\n    }\n\n    this.dice_box.prototype.search_dice_by_mouse = function(ev) {\n        var m = $t.get_mouse_coords(ev);\n        var intersects = (new THREE.Raycaster(this.camera.position, \n                    (new THREE.Vector3((m.x - this.cw) / this.aspect,\n                                       1 - (m.y - this.ch) / this.aspect, this.w / 9))\n                    .sub(this.camera.position).normalize())).intersectObjects(this.dices);\n        if (intersects.length) return intersects[0].object.userData;\n    }\n\n    this.dice_box.prototype.draw_selector = function() {\n        this.clear();\n        var step = this.w / 4.5;\n        this.pane = new THREE.Mesh(new THREE.PlaneGeometry(this.w * 6, this.h * 6, 1, 1), \n                new THREE.MeshPhongMaterial(that.selector_back_colors));\n        this.pane.receiveShadow = true;\n        this.pane.position.set(0, 0, 1);\n        this.scene.add(this.pane);\n\n        var mouse_captured = false;\n\n        for (var i = 0, pos = -3; i < that.known_types.length; ++i, ++pos) {\n            var dice = $t.dice['create_' + that.known_types[i]]();\n            dice.position.set(pos * step, 0, step * 0.5);\n            dice.castShadow = true;\n            dice.userData = that.known_types[i];\n            this.dices.push(dice); this.scene.add(dice);\n        }\n\n        this.running = (new Date()).getTime();\n        this.last_time = 0;\n        if (this.animate_selector) this.__selector_animate(this.running);\n        else this.renderer.render(this.scene, this.camera);\n    }\n\n    function throw_dices(box, vector, boost, dist, notation_getter, before_roll, after_roll) {\n        var uat = $t.dice.use_adapvite_timestep;\n        function roll(request_results) {\n            if (after_roll) {\n                box.clear();\n                box.roll(vectors, request_results || notation.result, function(result) {\n                    if (after_roll) after_roll.call(box, notation, result);\n                    box.rolling = false;\n                    $t.dice.use_adapvite_timestep = uat;\n                });\n            }\n        }\n        vector.x /= dist; vector.y /= dist;\n        var notation = notation_getter.call(box);\n        if (notation.set.length == 0) return;\n        var vectors = box.generate_vectors(notation, vector, boost);\n        box.rolling = true;\n        if (before_roll) before_roll.call(box, vectors, notation, roll);\n        else roll();\n    }\n\n    this.dice_box.prototype.bind_mouse = function(container, notation_getter, before_roll, after_roll) {\n        var box = this;\n        $t.bind(container, ['mousedown', 'touchstart'], function(ev) {\n            ev.preventDefault();\n            box.mouse_time = (new Date()).getTime();\n            box.mouse_start = $t.get_mouse_coords(ev);\n        });\n        $t.bind(container, ['mouseup', 'touchend'], function(ev) {\n            if (box.rolling) return;\n            if (box.mouse_start == undefined) return;\n            ev.stopPropagation();\n            var m = $t.get_mouse_coords(ev);\n            var vector = { x: m.x - box.mouse_start.x, y: -(m.y - box.mouse_start.y) };\n            box.mouse_start = undefined;\n            var dist = Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n            if (dist < Math.sqrt(box.w * box.h * 0.01)) return;\n            var time_int = (new Date()).getTime() - box.mouse_time;\n            if (time_int > 2000) time_int = 2000;\n            var boost = Math.sqrt((2500 - time_int) / 2500) * dist * 2;\n            prepare_rnd(function() {\n                throw_dices(box, vector, boost, dist, notation_getter, before_roll, after_roll);\n            });\n        });\n    }\n\n    this.dice_box.prototype.bind_throw = function(button, notation_getter, before_roll, after_roll) {\n        var box = this;\n        $t.bind(button, ['mouseup', 'touchend'], function(ev) {\n            ev.stopPropagation();\n            box.start_throw(notation_getter, before_roll, after_roll);\n        });\n    }\n\n    this.dice_box.prototype.start_throw = function(notation_getter, before_roll, after_roll) {\n        var box = this;\n        if (box.rolling) return;\n        prepare_rnd(function() {\n            var vector = { x: (rnd() * 2 - 1) * box.w, y: -(rnd() * 2 - 1) * box.h };\n            var dist = Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n            var boost = (rnd() + 3) * dist;\n            throw_dices(box, vector, boost, dist, notation_getter, before_roll, after_roll);\n        });\n    }\n\n}).apply(teal.dice = teal.dice || {});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction dice_initialize(container) {\n    $t.remove($t.id('loading_text'));\n\n    var canvas = $t.id('canvas');\n    canvas.style.width = window.innerWidth - 1 + 'px';\n    canvas.style.height = window.innerHeight - 1 + 'px';\n    var label = $t.id('label');\n    var set = $t.id('set');\n    var selector_div = $t.id('selector_div');\n    var info_div = $t.id('info_div');\n    on_set_change();\n\n    $t.dice.use_true_random = false;\n\n    function on_set_change(ev) { set.style.width = set.value.length + 3 + 'ex'; }\n    $t.bind(set, 'keyup', on_set_change);\n    $t.bind(set, 'mousedown', function(ev) { ev.stopPropagation(); });\n    $t.bind(set, 'mouseup', function(ev) { ev.stopPropagation(); });\n    $t.bind(set, 'focus', function(ev) { $t.set(container, { class: '' }); });\n    $t.bind(set, 'blur', function(ev) { $t.set(container, { class: 'noselect' }); });\n\n    $t.bind($t.id('clear'), ['mouseup', 'touchend'], function(ev) {\n        ev.stopPropagation();\n        set.value = '0';\n        on_set_change();\n    });\n\n    var params = $t.get_url_params();\n\n    if (params.chromakey) {\n        $t.dice.desk_color = 0x00ff00;\n        info_div.style.display = 'none';\n        $t.id('control_panel').style.display = 'none';\n    }\n    if (params.shadows == 0) {\n        $t.dice.use_shadows = false;\n    }\n    if (params.color == 'white') {\n        $t.dice.dice_color = '#808080';\n        $t.dice.label_color = '#202020';\n    }\n\n    var box = new $t.dice.dice_box(canvas, { w: 500, h: 300 });\n    box.animate_selector = false;\n\n    $t.bind(window, 'resize', function() {\n        canvas.style.width = window.innerWidth - 1 + 'px';\n        canvas.style.height = window.innerHeight - 1 + 'px';\n        box.reinit(canvas, { w: 500, h: 300 });\n    });\n\n    function show_selector() {\n        info_div.style.display = 'none';\n        selector_div.style.display = 'inline-block';\n        box.draw_selector();\n    }\n\n    function before_roll(vectors, notation, callback) {\n        info_div.style.display = 'none';\n        selector_div.style.display = 'none';\n        // do here rpc call or whatever to get your own result of throw.\n        // then callback with array of your result, example:\n        // callback([2, 2, 2, 2]); // for 4d6 where all dice values are 2.\n        callback();\n    }\n\n    function notation_getter() {\n        return $t.dice.parse_notation(set.value);\n    }\n\n    function after_roll(notation, result) {\n        if (params.chromakey || params.noresult) return;\n        var res = result.join(' ');\n        if (notation.constant) {\n            if (notation.constant > 0) res += ' +' + notation.constant;\n            else res += ' -' + Math.abs(notation.constant);\n        }\n        if (result.length > 1) res += ' = ' + \n                (result.reduce(function(s, a) { return s + a; }) + notation.constant);\n        label.innerHTML = res;\n        info_div.style.display = 'inline-block';\n    }\n\n    box.bind_mouse(container, notation_getter, before_roll, after_roll);\n    box.bind_throw($t.id('throw'), notation_getter, before_roll, after_roll);\n\n    $t.bind(container, ['mouseup', 'touchend'], function(ev) {\n        ev.stopPropagation();\n        if (selector_div.style.display == 'none') {\n            if (!box.rolling) show_selector();\n            box.rolling = false;\n            return;\n        }\n        var name = box.search_dice_by_mouse(ev);\n        if (name != undefined) {\n            var notation = $t.dice.parse_notation(set.value);\n            notation.set.push(name);\n            set.value = $t.dice.stringify_notation(notation);\n            on_set_change();\n        }\n    });\n\n    if (params.notation) {\n        set.value = params.notation;\n    }\n    if (params.roll) {\n        $t.raise_event($t.id('throw'), 'mouseup');\n    }\n    else {\n        show_selector();\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nuseEffect(()=> {\n    dice_initialize(document.querySelector('[data-dice-body]'));\n}, [])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n  function handleInput(e) {\n\n  }\n\n  return (\n    <div data-dice-body style={{margin: \"0\"}}>\n      <div id=\"control_panel\" className=\"control_panel\">\n          <h6><img src=\"../favicon.ico\" style={{verticalAlign: \"middle\"}}></img> <a href=\"..\">teal</a> dice</h6>\n          <p id=\"loading_text\">Loading libraries, please wait a bit...</p>\n          <p id=\"info_text\"><a href=\"http://www.teall.info/2014/01/online-3d-dice-roller.html\">More info and help</a></p>\n          <p id=\"info_text\"><a href=\"/mdice\">Multiplayer version</a></p>\n      </div>\n      <div id=\"info_div\" style={{display: \"none\"}}>\n          <div className=\"center_field\">\n              <span id=\"label\"></span>\n          </div>\n          <div className=\"center_field\">\n              <div className=\"bottom_field\">\n                  <span id=\"labelhelp\">click to continue or tap and drag again</span>\n              </div>\n          </div>\n      </div>\n      <div id=\"selector_div\" style={{display: \"none\"}}>\n          <div className=\"center_field\">\n              <div id=\"sethelp\">\n                  choose your dice set by clicking the dices or by direct input of notation,<br/>\n                  tap and drag on free space of screen or hit throw button to roll\n              </div>\n          </div>\n          <div className=\"center_field\">\n              <input type=\"text\" id=\"set\" value=\"4d6\" onChange={e => handleInput(e.target.value)} ></input><br/>\n              <button id=\"clear\">clear</button>\n              <button style={{marginLeft: \"0.6em\"}} id=\"throw\">throw</button>\n          </div>\n      </div>\n      <div id=\"canvas\"></div>  \n    </div>\n  )\n\n\n\n\n}\n\n\n\n\n\n\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}